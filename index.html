<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اپلیکیشن حسابداری</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'vazir': ['Vazir', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Vazir:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazir', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        /* Theme Styles */
        [data-theme="light"] {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
        }
        [data-theme="dark"] {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #f1f5f9;
        }
        [data-theme="purple"] {
            background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%);
        }
        [data-theme="gold"] {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }
        
        .theme-bg-secondary {
            background: white;
        }
        [data-theme="dark"] .theme-bg-secondary {
            background: #334155;
        }
        [data-theme="purple"] .theme-bg-secondary {
            background: #fdf4ff;
        }
        [data-theme="gold"] .theme-bg-secondary {
            background: #fefce8;
        }
        
        .theme-text-primary {
            color: #1f2937;
        }
        [data-theme="dark"] .theme-text-primary {
            color: #f1f5f9;
        }
        [data-theme="purple"] .theme-text-primary {
            color: #581c87;
        }
        [data-theme="gold"] .theme-text-primary {
            color: #92400e;
        }
        
        .theme-text-secondary {
            color: #6b7280;
        }
        [data-theme="dark"] .theme-text-secondary {
            color: #cbd5e1;
        }
        [data-theme="purple"] .theme-text-secondary {
            color: #a855f7;
        }
        [data-theme="gold"] .theme-text-secondary {
            color: #d97706;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Authentication Screens -->
    <div id="authScreens" class="min-h-screen flex items-center justify-center">
        <!-- Login Screen -->
        <div id="loginScreen" class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">💰</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">اپلیکیشن حسابداری</h1>
                <p class="text-gray-600">ورود به حساب کاربری</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">کد 12 رقمی</label>
                    <input type="text" id="loginCode" required maxlength="12" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="کد 12 رقمی خود را وارد کنید">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">رمز عبور</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="رمز عبور خود را وارد کنید">
                </div>
                
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                    🔐 ورود
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600">حساب کاربری ندارید؟</p>
                <button onclick="showRegisterScreen()" class="text-blue-500 hover:text-blue-600 font-medium">ثبت نام کنید</button>
            </div>
            
            <div class="mt-4 text-center">
                <button onclick="showCodeActivationScreen()" class="text-green-500 hover:text-green-600 font-medium text-sm">فعال‌سازی کد جدید</button>
            </div>
            
            <!-- Admin access hidden -->
        </div>
        
        <!-- Register Screen -->
        <div id="registerScreen" class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 hidden">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">📝</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ثبت نام</h1>
                <p class="text-gray-600">ایجاد حساب کاربری جدید</p>
            </div>
            
            <form id="registerForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">نام و نام خانوادگی</label>
                    <input type="text" id="registerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="نام کامل خود را وارد کنید">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">شماره تلفن</label>
                    <input type="tel" id="registerPhone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="09xxxxxxxxx">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ایمیل (اختیاری)</label>
                    <input type="email" id="registerEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="example@email.com">
                </div>
                
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                    📤 ارسال درخواست
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600">حساب کاربری دارید؟</p>
                <button onclick="showLoginScreen()" class="text-blue-500 hover:text-blue-600 font-medium">وارد شوید</button>
            </div>
        </div>
        
        <!-- Code Activation Screen -->
        <div id="codeActivationScreen" class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 hidden">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">🔑</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">فعال‌سازی کد</h1>
                <p class="text-gray-600">کد 12 رقمی خود را فعال کنید</p>
            </div>
            
            <form id="codeActivationForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">کد 12 رقمی</label>
                    <input type="text" id="activationCode" required maxlength="12" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="کد دریافتی از مدیر">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">رمز عبور جدید</label>
                    <input type="password" id="newPassword" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="حداقل 6 کاراکتر">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">تکرار رمز عبور</label>
                    <input type="password" id="confirmPassword" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="رمز عبور را مجدداً وارد کنید">
                </div>
                
                <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                    ✅ فعال‌سازی حساب
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button onclick="showLoginScreen()" class="text-blue-500 hover:text-blue-600 font-medium">بازگشت به ورود</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="min-h-screen hidden">
        <!-- Admin Login -->
        <div id="adminLoginScreen" class="min-h-screen flex items-center justify-center">
            <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">👑</div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">پنل مدیریت</h1>
                    <p class="text-gray-600">ورود مدیر سیستم</p>
                </div>
                
                <form id="adminLoginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">نام کاربری</label>
                        <input type="text" id="adminUsername" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" placeholder="نام کاربری مدیر">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">رمز عبور</label>
                        <input type="password" id="adminPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" placeholder="رمز عبور مدیر">
                    </div>
                    
                    <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        👑 ورود مدیر
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <button onclick="backToUserLogin()" class="text-blue-500 hover:text-blue-600 font-medium text-sm">بازگشت به ورود کاربران</button>
                </div>
            </div>
        </div>
        
        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <header class="bg-red-600 shadow-lg">
                <div class="container mx-auto px-6 py-4">
                    <div class="flex justify-between items-center">
                        <h1 class="text-2xl font-bold text-white flex items-center">
                            <span class="text-3xl ml-3">👑</span>
                            پنل مدیریت سیستم
                        </h1>
                        <div class="flex gap-3">
                            <button onclick="refreshAdminData()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-all">
                                🔄 بروزرسانی
                            </button>
                            <button onclick="adminLogout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-all">
                                🚪 خروج
                            </button>
                        </div>
                    </div>
                </div>
            </header>
            
            <div class="container mx-auto px-6 py-8">
                <!-- Admin Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-blue-400 to-blue-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100">کل کاربران</p>
                                <p class="text-2xl font-bold" id="totalUsers">0</p>
                            </div>
                            <span class="text-4xl">👥</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-400 to-green-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100">کاربران فعال</p>
                                <p class="text-2xl font-bold" id="activeUsers">0</p>
                            </div>
                            <span class="text-4xl">✅</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100">در انتظار تایید</p>
                                <p class="text-2xl font-bold" id="pendingUsers">0</p>
                            </div>
                            <span class="text-4xl">⏳</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-red-400 to-red-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100">کاربران مسدود</p>
                                <p class="text-2xl font-bold" id="blockedUsers">0</p>
                            </div>
                            <span class="text-4xl">🚫</span>
                        </div>
                    </div>
                </div>
                
                <!-- Pending Registrations -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">⏳</span>
                        درخواست‌های ثبت نام
                    </h2>
                    
                    <div id="pendingRegistrations">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-6xl">📝</span>
                            <p class="mt-4 text-lg">درخواست جدیدی وجود ندارد</p>
                        </div>
                    </div>
                </div>
                
                <!-- Subscription Management -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">💎</span>
                        مدیریت اشتراک‌ها
                    </h2>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">فعال‌سازی اشتراک برای کاربر</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">انتخاب کاربر</label>
                                <select id="subscriptionUserId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">کاربر را انتخاب کنید</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">نوع اشتراک</label>
                                <select id="subscriptionType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">نوع اشتراک را انتخاب کنید</option>
                                    <option value="1month">یک ماهه (۹۹ تومان)</option>
                                    <option value="3month">سه ماهه (۱۹۹ تومان)</option>
                                    <option value="6month">شش ماهه (۳۹۹ تومان)</option>
                                    <option value="12month">یک ساله (۵۹۹ تومان)</option>
                                    <option value="5year">پنج ساله (۱,۵۰۰ تومان)</option>
                                    <option value="lifetime">نامحدود (۳,۰۰۰ تومان)</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="activateUserSubscription()" class="mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
                            ✅ فعال‌سازی اشتراک
                        </button>
                    </div>
                    
                    <div id="subscriptionsList">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">لیست اشتراک‌های فعال</h3>
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-6xl">💎</span>
                            <p class="mt-4 text-lg">اشتراک فعالی وجود ندارد</p>
                        </div>
                    </div>
                </div>

                <!-- User Management -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">👥</span>
                        مدیریت کاربران
                    </h2>
                    
                    <div id="usersList">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-6xl">👤</span>
                            <p class="mt-4 text-lg">کاربری وجود ندارد</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                    <span class="text-4xl ml-3">💰</span>
                    اپلیکیشن حسابداری
                </h1>
                <div class="flex gap-3 items-center">
                    <div id="trialStatus" class="bg-yellow-100 border border-yellow-300 rounded-lg px-4 py-2 text-sm font-medium text-yellow-800">
                        <!-- Trial status will be populated by JavaScript -->
                    </div>
                    <select id="themeSelector" onchange="changeTheme()" class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm font-medium">
                        <option value="light">🌞 روشن</option>
                        <option value="dark">🌙 تاریک</option>
                        <option value="purple">💜 بنفش</option>
                        <option value="gold">✨ طلایی</option>
                    </select>
                    <button onclick="showHelp()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        ❓ راهنما
                    </button>
                    <button onclick="showSupport()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        🎧 پشتیبانی
                    </button>
                    <button onclick="showUserSubscriptionModal()" class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        💎 خرید اشتراک
                    </button>
                    <button onclick="exportToPDF()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        📄 دانلود PDF
                    </button>
                    <button onclick="shareData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        📤 اشتراک‌گذاری
                    </button>
                    <button onclick="userLogout()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                        🚪 خروج
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Add Person Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">👤</span>
                        افزودن شخص جدید
                    </h2>
                    
                    <form id="personForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">نام و نام خانوادگی</label>
                            <input type="text" id="personName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">شماره تلفن</label>
                            <input type="tel" id="personPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">آدرس</label>
                            <textarea id="personAddress" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">عکس پروفایل</label>
                            <input type="file" id="personPhoto" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                            ✅ افزودن شخص
                        </button>
                    </form>
                </div>

                <!-- Transaction Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mt-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">💸</span>
                        ثبت تراکنش
                    </h2>
                    
                    <form id="transactionForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">انتخاب شخص</label>
                            <select id="transactionPerson" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">شخص را انتخاب کنید</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">نوع تراکنش</label>
                            <select id="transactionType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">نوع را انتخاب کنید</option>
                                <option value="debt">بدهکار (من به او بدهکارم)</option>
                                <option value="credit">طلبکار (او به من بدهکار است)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">مبلغ (تومان)</label>
                            <input type="number" id="transactionAmount" required min="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">توضیحات</label>
                            <textarea id="transactionDescription" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"></textarea>
                        </div>
                        
                        <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg">
                            💰 ثبت تراکنش
                        </button>
                    </form>
                </div>
            </div>

            <!-- People List and Transactions -->
            <div class="lg:col-span-2">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-green-400 to-green-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm">کل طلب</p>
                                <p class="text-2xl font-bold" id="totalCredit">0</p>
                            </div>
                            <span class="text-4xl">📈</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-red-400 to-red-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100 text-sm">کل بدهی</p>
                                <p class="text-2xl font-bold" id="totalDebt">0</p>
                            </div>
                            <span class="text-4xl">📉</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-400 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm">تعداد اشخاص</p>
                                <p class="text-2xl font-bold" id="totalPeople">0</p>
                            </div>
                            <span class="text-4xl">👥</span>
                        </div>
                    </div>
                </div>

                <!-- People List -->
                <div class="theme-bg-secondary rounded-xl shadow-lg p-6 border border-gray-200">
                    <h2 class="text-2xl font-bold theme-text-primary mb-6 flex items-center">
                        <span class="text-2xl ml-2">📋</span>
                        لیست اشخاص و حساب‌ها
                    </h2>
                    
                    <div id="peopleList" class="space-y-4">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-6xl">👤</span>
                            <p class="mt-4 text-lg">هنوز شخصی اضافه نشده است</p>
                            <p class="text-sm text-gray-400">از فرم سمت راست شخص جدید اضافه کنید</p>
                        </div>
                    </div>
                </div>

                <!-- 3D Charts -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mt-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">📈</span>
                        نمودارهای سه بعدی
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">نمودار دایره‌ای بدهی/طلب</h3>
                            <div id="pieChart" style="height: 400px;"></div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">نمودار ستونی موجودی اشخاص</h3>
                            <div id="barChart" style="height: 400px;"></div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">نمودار سه بعدی تراکنش‌ها در طول زمان</h3>
                        <div id="surface3D" style="height: 500px;"></div>
                    </div>
                </div>

                <!-- Individual Person Tables -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mt-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">📋</span>
                        جداول جزئیات هر فرد
                    </h2>
                    
                    <div id="individualTables">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-6xl">📊</span>
                            <p class="mt-4 text-lg">هنوز شخصی اضافه نشده است</p>
                            <p class="text-sm text-gray-400">پس از افزودن اشخاص، جداول جزئیات نمایش داده می‌شود</p>
                        </div>
                    </div>
                </div>

                <!-- Transactions List -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mt-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">💸</span>
                        تاریخچه تراکنش‌ها
                    </h2>
                    
                    <div id="transactionsList" class="space-y-3">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-6xl">💸</span>
                            <p class="mt-4 text-lg">هنوز تراکنشی ثبت نشده است</p>
                            <p class="text-sm text-gray-400">از فرم سمت راست تراکنش جدید اضافه کنید</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content theme-bg-secondary theme-text-primary">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">📚 راهنمای استفاده</h2>
                <button onclick="closeModal('helpModal')" class="text-2xl hover:opacity-70">&times;</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <span class="ml-2">👤</span>
                        افزودن شخص جدید
                    </h3>
                    <p class="theme-text-secondary">نام، شماره تلفن، آدرس و عکس شخص را وارد کنید. تنها نام اجباری است.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <span class="ml-2">💸</span>
                        ثبت تراکنش
                    </h3>
                    <p class="theme-text-secondary">شخص، نوع تراکنش (بدهکار/طلبکار) و مبلغ را انتخاب کنید. توضیحات اختیاری است.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <span class="ml-2">📊</span>
                        گزارش فردی
                    </h3>
                    <p class="theme-text-secondary">روی دکمه "گزارش" کنار هر شخص کلیک کنید تا گزارش کامل او را ببینید و دانلود کنید.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <span class="ml-2">🎨</span>
                        تغییر تم
                    </h3>
                    <p class="theme-text-secondary">از منوی بالای صفحه می‌توانید بین تم‌های مختلف (روشن، تاریک، بنفش، طلایی) انتخاب کنید.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <span class="ml-2">📤</span>
                        اشتراک‌گذاری
                    </h3>
                    <p class="theme-text-secondary">گزارش‌ها را می‌توانید در تلگرام، واتساپ، ایتا و سایر پلتفرم‌ها به اشتراک بگذارید.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="modal">
        <div class="modal-content theme-bg-secondary theme-text-primary">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">🎧 پشتیبانی و ارتباط با ما</h2>
                <button onclick="closeModal('supportModal')" class="text-2xl hover:opacity-70">&times;</button>
            </div>
            
            <div class="space-y-6">
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">🛠️</div>
                    <h3 class="text-xl font-bold theme-text-primary mb-2">تیم پشتیبانی آماده کمک به شماست</h3>
                    <p class="theme-text-secondary">برای هرگونه سوال، مشکل یا پیشنهاد با ما در ارتباط باشید</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Phone Support -->
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="contactSupport('phone')">
                        <div class="text-4xl mb-3">
                            <svg class="w-12 h-12 mx-auto text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                            </svg>
                        </div>
                        <h4 class="font-bold text-blue-800 mb-2">تماس تلفنی</h4>
                        <p class="text-blue-600 font-medium">۰۹۹۳۶۵۶۵۵۱۰۶</p>
                        <p class="text-sm text-blue-500 mt-2">پاسخگویی ۲۴ ساعته</p>
                    </div>
                    
                    <!-- Telegram Support -->
                    <div class="bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl p-6 text-center text-white hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="contactSupport('telegram')">
                        <div class="text-4xl mb-3">
                            <svg class="w-12 h-12 mx-auto text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                            </svg>
                        </div>
                        <h4 class="font-bold mb-2">تلگرام</h4>
                        <p class="font-medium">@Spaincar7</p>
                        <p class="text-sm text-blue-100 mt-2">پاسخ سریع و آنلاین</p>
                    </div>
                    
                    <!-- WhatsApp Support -->
                    <div class="bg-gradient-to-r from-green-400 to-green-500 rounded-xl p-6 text-center text-white hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="contactSupport('whatsapp')">
                        <div class="text-4xl mb-3">
                            <svg class="w-12 h-12 mx-auto text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                            </svg>
                        </div>
                        <h4 class="font-bold mb-2">واتساپ</h4>
                        <p class="font-medium">۰۹۱۹۹۷۶۴۱۵۷</p>
                        <p class="text-sm text-green-100 mt-2">چت و تماس صوتی</p>
                    </div>
                    
                    <!-- Eitaa Support -->
                    <div class="bg-gradient-to-r from-purple-400 to-purple-500 rounded-xl p-6 text-center text-white hover:shadow-lg transition-all duration-200 cursor-pointer" onclick="contactSupport('eitaa')">
                        <div class="text-4xl mb-3">
                            <svg class="w-12 h-12 mx-auto text-white" fill="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="2"/>
                                <text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor">ایتا</text>
                            </svg>
                        </div>
                        <h4 class="font-bold mb-2">ایتا</h4>
                        <p class="font-medium">@Spaincar77</p>
                        <p class="text-sm text-purple-100 mt-2">پیام‌رسان داخلی</p>
                    </div>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl ml-2">💡</span>
                        <h4 class="font-bold text-yellow-800">نکات مهم:</h4>
                    </div>
                    <ul class="text-yellow-700 text-sm space-y-2">
                        <li>• قبل از تماس، لطفاً از بخش راهنما استفاده کنید</li>
                        <li>• برای گزارش مشکل، اسکرین‌شات ارسال کنید</li>
                        <li>• پیشنهادات شما برای بهبود برنامه ارزشمند است</li>
                        <li>• زمان پاسخگویی: شنبه تا پنج‌شنبه ۹ تا ۲۱</li>
                    </ul>
                </div>
                
                <div class="text-center">
                    <p class="text-sm theme-text-secondary">
                        🌟 رضایت شما اولویت ماست 🌟
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscriptionModal" class="modal">
        <div class="modal-content theme-bg-secondary theme-text-primary max-w-4xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold flex items-center">
                    <span class="text-3xl ml-3">💎</span>
                    پلان‌های اشتراک
                </h2>
                <button onclick="closeModal('subscriptionModal')" class="text-2xl hover:opacity-70">&times;</button>
            </div>
            
            <div class="mb-8 text-center">
                <div class="bg-gradient-to-r from-red-100 to-red-200 border border-red-300 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-center mb-2">
                        <span class="text-3xl ml-2">⏰</span>
                        <h3 class="text-xl font-bold text-red-800">دوره آزمایشی به پایان رسید!</h3>
                    </div>
                    <p class="text-red-700">برای ادامه استفاده از تمامی امکانات، لطفاً یکی از پلان‌های زیر را انتخاب کنید</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- 1 Month Plan -->
                <div class="border-2 border-blue-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-blue-50 to-blue-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">📅</div>
                        <h3 class="text-xl font-bold text-blue-800 mb-2">یک ماهه</h3>
                        <div class="text-3xl font-bold text-blue-600 mb-4">۹۹ تومان</div>
                        <ul class="text-sm text-blue-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی آنلاین</li>
                        </ul>
                        <button onclick="purchaseSubscription('1month')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 3 Month Plan -->
                <div class="border-2 border-green-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-green-50 to-green-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🌟</div>
                        <h3 class="text-xl font-bold text-green-800 mb-2">سه ماهه</h3>
                        <div class="text-3xl font-bold text-green-600 mb-2">۱۹۹ تومان</div>
                        <div class="text-sm text-green-500 mb-4">صرفه‌جویی ۹۸ تومان</div>
                        <ul class="text-sm text-green-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اولویت‌دار</li>
                        </ul>
                        <button onclick="purchaseSubscription('3month')" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 6 Month Plan -->
                <div class="border-2 border-purple-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-purple-50 to-purple-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💜</div>
                        <h3 class="text-xl font-bold text-purple-800 mb-2">شش ماهه</h3>
                        <div class="text-3xl font-bold text-purple-600 mb-2">۳۹۹ تومان</div>
                        <div class="text-sm text-purple-500 mb-4">صرفه‌جویی ۱۹۵ تومان</div>
                        <ul class="text-sm text-purple-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی VIP</li>
                        </ul>
                        <button onclick="purchaseSubscription('6month')" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 12 Month Plan -->
                <div class="border-2 border-yellow-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-yellow-50 to-yellow-100 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                        <span class="bg-yellow-500 text-white px-4 py-1 rounded-full text-sm font-bold">محبوب</span>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">🏆</div>
                        <h3 class="text-xl font-bold text-yellow-800 mb-2">یک ساله</h3>
                        <div class="text-3xl font-bold text-yellow-600 mb-2">۵۹۹ تومان</div>
                        <div class="text-sm text-yellow-500 mb-4">صرفه‌جویی ۵۸۹ تومان</div>
                        <ul class="text-sm text-yellow-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اختصاصی</li>
                            <li>✅ آپدیت‌های رایگان</li>
                        </ul>
                        <button onclick="purchaseSubscription('12month')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 5 Year Plan -->
                <div class="border-2 border-indigo-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-indigo-50 to-indigo-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💎</div>
                        <h3 class="text-xl font-bold text-indigo-800 mb-2">پنج ساله</h3>
                        <div class="text-3xl font-bold text-indigo-600 mb-2">۱,۵۰۰ تومان</div>
                        <div class="text-sm text-indigo-500 mb-4">صرفه‌جویی ۲,۴۷۵ تومان</div>
                        <ul class="text-sm text-indigo-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اختصاصی</li>
                            <li>✅ آپدیت‌های رایگان</li>
                            <li>✅ امکانات ویژه</li>
                        </ul>
                        <button onclick="purchaseSubscription('5year')" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- Lifetime Plan -->
                <div class="border-2 border-red-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-red-50 to-red-100 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                        <span class="bg-red-500 text-white px-4 py-1 rounded-full text-sm font-bold">بهترین ارزش</span>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">♾️</div>
                        <h3 class="text-xl font-bold text-red-800 mb-2">نامحدود</h3>
                        <div class="text-3xl font-bold text-red-600 mb-2">۳,۰۰۰ تومان</div>
                        <div class="text-sm text-red-500 mb-4">یکبار پرداخت - مادام‌العمر</div>
                        <ul class="text-sm text-red-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی مادام‌العمر</li>
                            <li>✅ تمام آپدیت‌ها رایگان</li>
                            <li>✅ امکانات ویژه و جدید</li>
                            <li>✅ بدون تاریخ انقضا</li>
                        </ul>
                        <button onclick="purchaseSubscription('lifetime')" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-blue-100 to-purple-100 border border-blue-200 rounded-lg p-6">
                <div class="text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <span class="text-2xl ml-2">🎧</span>
                        نحوه خرید اشتراک
                    </h3>
                    <p class="text-gray-700 mb-4">برای خرید اشتراک، با تیم پشتیبانی ما تماس بگیرید:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="contactSupport('phone')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📞 ۰۹۹۳۶۵۶۵۵۱۰۶
                        </button>
                        <button onclick="contactSupport('telegram')" class="bg-blue-400 hover:bg-blue-500 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📱 @Spaincar7
                        </button>
                        <button onclick="contactSupport('whatsapp')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            💬 ۰۹۱۹۹۷۶۴۱۵۷
                        </button>
                        <button onclick="contactSupport('eitaa')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            🔵 @Spaincar77
                        </button>
                    </div>
                    
                    <div class="mt-4 text-sm text-gray-600">
                        <p>⏰ پشتیبانی: شنبه تا پنج‌شنبه ۹ تا ۲۱</p>
                        <p>💳 پرداخت: کارت به کارت، درگاه بانکی</p>
                        <p>⚡ فعال‌سازی: فوری پس از پرداخت</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Subscription Modal -->
    <div id="userSubscriptionModal" class="modal">
        <div class="modal-content theme-bg-secondary theme-text-primary max-w-5xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold flex items-center">
                    <span class="text-3xl ml-3">💎</span>
                    خرید اشتراک حسابداری
                </h2>
                <button onclick="closeModal('userSubscriptionModal')" class="text-2xl hover:opacity-70">&times;</button>
            </div>
            
            <!-- Current Status -->
            <div class="mb-8 text-center">
                <div id="currentSubscriptionStatus" class="bg-gradient-to-r from-blue-100 to-purple-100 border border-blue-200 rounded-lg p-4 mb-6">
                    <!-- Status will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Subscription Plans -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- 1 Month Plan -->
                <div class="border-2 border-blue-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-blue-50 to-blue-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">📅</div>
                        <h3 class="text-xl font-bold text-blue-800 mb-2">یک ماهه</h3>
                        <div class="text-3xl font-bold text-blue-600 mb-4">۹۹ تومان</div>
                        <ul class="text-sm text-blue-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی آنلاین</li>
                        </ul>
                        <button onclick="purchaseUserSubscription('1month')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all">
                            انتخاب این پلان
                        </button>
                    </div>
                </div>
                
                <!-- 3 Month Plan -->
                <div class="border-2 border-green-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-green-50 to-green-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🌟</div>
                        <h3 class="text-xl font-bold text-green-800 mb-2">سه ماهه</h3>
                        <div class="text-3xl font-bold text-green-600 mb-2">۱۹۹ تومان</div>
                        <div class="text-sm text-green-500 mb-4">صرفه‌جویی ۹۸ تومان</div>
                        <ul class="text-sm text-green-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اولویت‌دار</li>
                        </ul>
                        <button onclick="purchaseUserSubscription('3month')" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all">
                            انتخاب این پلان
                        </button>
                    </div>
                </div>
                
                <!-- 6 Month Plan -->
                <div class="border-2 border-purple-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-purple-50 to-purple-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💜</div>
                        <h3 class="text-xl font-bold text-purple-800 mb-2">شش ماهه</h3>
                        <div class="text-3xl font-bold text-purple-600 mb-2">۳۹۹ تومان</div>
                        <div class="text-sm text-purple-500 mb-4">صرفه‌جویی ۱۹۵ تومان</div>
                        <ul class="text-sm text-purple-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی VIP</li>
                        </ul>
                        <button onclick="purchaseUserSubscription('6month')" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-medium transition-all">
                            انتخاب این پلان
                        </button>
                    </div>
                </div>
                
                <!-- 12 Month Plan -->
                <div class="border-2 border-yellow-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-yellow-50 to-yellow-100 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                        <span class="bg-yellow-500 text-white px-4 py-1 rounded-full text-sm font-bold">محبوب</span>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">🏆</div>
                        <h3 class="text-xl font-bold text-yellow-800 mb-2">یک ساله</h3>
                        <div class="text-3xl font-bold text-yellow-600 mb-2">۵۹۹ تومان</div>
                        <div class="text-sm text-yellow-500 mb-4">صرفه‌جویی ۵۸۹ تومان</div>
                        <ul class="text-sm text-yellow-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اختصاصی</li>
                            <li>✅ آپدیت‌های رایگان</li>
                        </ul>
                        <button onclick="purchaseUserSubscription('12month')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-lg font-medium transition-all">
                            انتخاب این پلان
                        </button>
                    </div>
                </div>
                
                <!-- 5 Year Plan -->
                <div class="border-2 border-indigo-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-indigo-50 to-indigo-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💎</div>
                        <h3 class="text-xl font-bold text-indigo-800 mb-2">پنج ساله</h3>
                        <div class="text-3xl font-bold text-indigo-600 mb-2">۱,۵۰۰ تومان</div>
                        <div class="text-sm text-indigo-500 mb-4">صرفه‌جویی ۲,۴۷۵ تومان</div>
                        <ul class="text-sm text-indigo-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اختصاصی</li>
                            <li>✅ آپدیت‌های رایگان</li>
                            <li>✅ امکانات ویژه</li>
                        </ul>
                        <button onclick="purchaseUserSubscription('5year')" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-lg font-medium transition-all">
                            انتخاب این پلان
                        </button>
                    </div>
                </div>
                
                <!-- Lifetime Plan -->
                <div class="border-2 border-red-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-red-50 to-red-100 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                        <span class="bg-red-500 text-white px-4 py-1 rounded-full text-sm font-bold">بهترین ارزش</span>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">♾️</div>
                        <h3 class="text-xl font-bold text-red-800 mb-2">نامحدود</h3>
                        <div class="text-3xl font-bold text-red-600 mb-2">۳,۰۰۰ تومان</div>
                        <div class="text-sm text-red-500 mb-4">یکبار پرداخت - مادام‌العمر</div>
                        <ul class="text-sm text-red-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی مادام‌العمر</li>
                            <li>✅ تمام آپدیت‌ها رایگان</li>
                            <li>✅ امکانات ویژه و جدید</li>
                            <li>✅ بدون تاریخ انقضا</li>
                        </ul>
                        <button onclick="purchaseUserSubscription('lifetime')" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium transition-all">
                            انتخاب این پلان
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Contact Support Section -->
            <div class="bg-gradient-to-r from-blue-100 to-purple-100 border border-blue-200 rounded-lg p-6">
                <div class="text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <span class="text-2xl ml-2">🎧</span>
                        نحوه خرید اشتراک
                    </h3>
                    <p class="text-gray-700 mb-4">پس از انتخاب پلان، با تیم پشتیبانی ما تماس بگیرید:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <button onclick="contactSupportForPurchase('phone')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📞 ۰۹۹۳۶۵۶۵۵۱۰۶
                        </button>
                        <button onclick="contactSupportForPurchase('telegram')" class="bg-blue-400 hover:bg-blue-500 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📱 @Spaincar7
                        </button>
                        <button onclick="contactSupportForPurchase('whatsapp')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            💬 ۰۹۱۹۹۷۶۴۱۵۷
                        </button>
                        <button onclick="contactSupportForPurchase('eitaa')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            🔵 @Spaincar77
                        </button>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-2xl ml-2">⚡</span>
                            <h4 class="font-bold text-yellow-800">مراحل خرید:</h4>
                        </div>
                        <ul class="text-yellow-700 text-sm space-y-1">
                            <li>۱. پلان مورد نظر را انتخاب کنید</li>
                            <li>۲. با پشتیبانی تماس بگیرید</li>
                            <li>۳. مبلغ را پرداخت کنید</li>
                            <li>۴. اشتراک فوراً فعال می‌شود</li>
                        </ul>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p>⏰ پشتیبانی: شنبه تا پنج‌شنبه ۹ تا ۲۱</p>
                            <p>💳 پرداخت: کارت به کارت، درگاه بانکی</p>
                            <p>⚡ فعال‌سازی: فوری پس از پرداخت</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- 1 Month Plan -->
                <div class="border-2 border-blue-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-blue-50 to-blue-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">📅</div>
                        <h3 class="text-xl font-bold text-blue-800 mb-2">یک ماهه</h3>
                        <div class="text-3xl font-bold text-blue-600 mb-4">۹۹ تومان</div>
                        <ul class="text-sm text-blue-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی آنلاین</li>
                        </ul>
                        <button onclick="purchaseSubscription('1month')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 3 Month Plan -->
                <div class="border-2 border-green-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-green-50 to-green-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🌟</div>
                        <h3 class="text-xl font-bold text-green-800 mb-2">سه ماهه</h3>
                        <div class="text-3xl font-bold text-green-600 mb-2">۱۹۹ تومان</div>
                        <div class="text-sm text-green-500 mb-4">صرفه‌جویی ۹۸ تومان</div>
                        <ul class="text-sm text-green-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اولویت‌دار</li>
                        </ul>
                        <button onclick="purchaseSubscription('3month')" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 6 Month Plan -->
                <div class="border-2 border-purple-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-purple-50 to-purple-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💜</div>
                        <h3 class="text-xl font-bold text-purple-800 mb-2">شش ماهه</h3>
                        <div class="text-3xl font-bold text-purple-600 mb-2">۳۹۹ تومان</div>
                        <div class="text-sm text-purple-500 mb-4">صرفه‌جویی ۱۹۵ تومان</div>
                        <ul class="text-sm text-purple-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی VIP</li>
                        </ul>
                        <button onclick="purchaseSubscription('6month')" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 12 Month Plan -->
                <div class="border-2 border-yellow-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-yellow-50 to-yellow-100 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                        <span class="bg-yellow-500 text-white px-4 py-1 rounded-full text-sm font-bold">محبوب</span>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">🏆</div>
                        <h3 class="text-xl font-bold text-yellow-800 mb-2">یک ساله</h3>
                        <div class="text-3xl font-bold text-yellow-600 mb-2">۵۹۹ تومان</div>
                        <div class="text-sm text-yellow-500 mb-4">صرفه‌جویی ۵۸۹ تومان</div>
                        <ul class="text-sm text-yellow-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اختصاصی</li>
                            <li>✅ آپدیت‌های رایگان</li>
                        </ul>
                        <button onclick="purchaseSubscription('12month')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- 5 Year Plan -->
                <div class="border-2 border-indigo-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-indigo-50 to-indigo-100">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💎</div>
                        <h3 class="text-xl font-bold text-indigo-800 mb-2">پنج ساله</h3>
                        <div class="text-3xl font-bold text-indigo-600 mb-2">۱,۵۰۰ تومان</div>
                        <div class="text-sm text-indigo-500 mb-4">صرفه‌جویی ۲,۴۷۵ تومان</div>
                        <ul class="text-sm text-indigo-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی اختصاصی</li>
                            <li>✅ آپدیت‌های رایگان</li>
                            <li>✅ امکانات ویژه</li>
                        </ul>
                        <button onclick="purchaseSubscription('5year')" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
                
                <!-- Lifetime Plan -->
                <div class="border-2 border-red-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-b from-red-50 to-red-100 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                        <span class="bg-red-500 text-white px-4 py-1 rounded-full text-sm font-bold">بهترین ارزش</span>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">♾️</div>
                        <h3 class="text-xl font-bold text-red-800 mb-2">نامحدود</h3>
                        <div class="text-3xl font-bold text-red-600 mb-2">۳,۰۰۰ تومان</div>
                        <div class="text-sm text-red-500 mb-4">یکبار پرداخت - مادام‌العمر</div>
                        <ul class="text-sm text-red-700 space-y-2 mb-6">
                            <li>✅ تمامی امکانات</li>
                            <li>✅ نامحدود تراکنش</li>
                            <li>✅ گزارش‌گیری PDF</li>
                            <li>✅ پشتیبانی مادام‌العمر</li>
                            <li>✅ تمام آپدیت‌ها رایگان</li>
                            <li>✅ امکانات ویژه و جدید</li>
                            <li>✅ بدون تاریخ انقضا</li>
                        </ul>
                        <button onclick="purchaseSubscription('lifetime')" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium transition-all">
                            خرید اشتراک
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-blue-100 to-purple-100 border border-blue-200 rounded-lg p-6">
                <div class="text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <span class="text-2xl ml-2">🎧</span>
                        نحوه خرید اشتراک
                    </h3>
                    <p class="text-gray-700 mb-4">برای خرید اشتراک، با تیم پشتیبانی ما تماس بگیرید:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="contactSupport('phone')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📞 ۰۹۹۳۶۵۶۵۵۱۰۶
                        </button>
                        <button onclick="contactSupport('telegram')" class="bg-blue-400 hover:bg-blue-500 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📱 @Spaincar7
                        </button>
                        <button onclick="contactSupport('whatsapp')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            💬 ۰۹۱۹۹۷۶۴۱۵۷
                        </button>
                        <button onclick="contactSupport('eitaa')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            🔵 @Spaincar77
                        </button>
                    </div>
                    
                    <div class="mt-4 text-sm text-gray-600">
                        <p>⏰ پشتیبانی: شنبه تا پنج‌شنبه ۹ تا ۲۱</p>
                        <p>💳 پرداخت: کارت به کارت، درگاه بانکی</p>
                        <p>⚡ فعال‌سازی: فوری پس از پرداخت</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Person Report Modal -->
    <div id="personReportModal" class="modal">
        <div class="modal-content theme-bg-secondary theme-text-primary">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">📊 گزارش فردی</h2>
                <button onclick="closeModal('personReportModal')" class="text-2xl hover:opacity-70">&times;</button>
            </div>
            
            <div id="personReportContent">
                <!-- Content will be populated by JavaScript -->
            </div>
            
            <div class="flex gap-3 mt-6 flex-wrap">
                <button onclick="downloadPersonPDF()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all">
                    📄 دانلود PDF
                </button>
                <button onclick="sharePersonReport('telegram')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all">
                    📱 تلگرام
                </button>
                <button onclick="sharePersonReport('whatsapp')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
                    💬 واتساپ
                </button>
                <button onclick="sharePersonReport('eitaa')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-all">
                    🔵 ایتا
                </button>
                <button onclick="sharePersonReport('sms')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-all">
                    📨 پیامک
                </button>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let isAdmin = false;
        let users = [];
        let pendingRegistrations = [];
        let people = [];
        let transactions = [];
        let currentPersonReport = null;
        
        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: 'admin_accounting_2024',
            password: 'SecureAdmin@2024#'
        };
        
        // Initialize system when page loads
        function initializeSystem() {
            console.log('Initializing system...');
            
            // Load data from localStorage
            loadSystemData();
            
            // Check URL hash for admin panel or secret admin access
            if (window.location.hash === '#admin' || window.location.hash === '#secret_admin_2024') {
                const savedAdmin = localStorage.getItem('currentAdmin');
                if (savedAdmin === 'true') {
                    isAdmin = true;
                    showAdminDashboard();
                } else {
                    showAdminPanel();
                }
                return;
            }
            
            // Check if user is logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    if (currentUser && currentUser.id) {
                        showMainApp();
                        return;
                    }
                } catch (e) {
                    console.error('Error parsing saved user:', e);
                    localStorage.removeItem('currentUser');
                }
            }
            
            // Default to login screen
            showAuthScreens();
        }
        
        // Load system data from localStorage
        function loadSystemData() {
            try {
                users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
                pendingRegistrations = JSON.parse(localStorage.getItem('pendingRegistrations') || '[]');
                console.log('Loaded users:', users.length);
                console.log('Loaded pending registrations:', pendingRegistrations.length);
            } catch (e) {
                console.error('Error loading system data:', e);
                users = [];
                pendingRegistrations = [];
            }
        }
        
        // Screen Management Functions
        function hideAllScreens() {
            const screens = ['authScreens', 'adminPanel', 'mainApp'];
            screens.forEach(screenId => {
                const element = document.getElementById(screenId);
                if (element) {
                    element.classList.add('hidden');
                }
            });
        }
        
        function showAuthScreens() {
            console.log('Showing auth screens');
            hideAllScreens();
            const authScreens = document.getElementById('authScreens');
            if (authScreens) {
                authScreens.classList.remove('hidden');
                showLoginScreen();
            }
        }
        
        function showAdminPanel() {
            console.log('Showing admin panel');
            hideAllScreens();
            const adminPanel = document.getElementById('adminPanel');
            const adminLogin = document.getElementById('adminLoginScreen');
            const adminDashboard = document.getElementById('adminDashboard');
            
            if (adminPanel && adminLogin && adminDashboard) {
                adminPanel.classList.remove('hidden');
                adminLogin.classList.remove('hidden');
                adminDashboard.classList.add('hidden');
            }
        }
        
        function showAdminDashboard() {
            console.log('Showing admin dashboard');
            hideAllScreens();
            const adminPanel = document.getElementById('adminPanel');
            const adminLogin = document.getElementById('adminLoginScreen');
            const adminDashboard = document.getElementById('adminDashboard');
            
            if (adminPanel && adminLogin && adminDashboard) {
                adminPanel.classList.remove('hidden');
                adminLogin.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                refreshAdminData();
            }
        }
        
        function showMainApp() {
            console.log('Showing main app');
            hideAllScreens();
            const mainApp = document.getElementById('mainApp');
            if (mainApp) {
                mainApp.classList.remove('hidden');
                loadUserData();
            }
        }
        
        // Auth Screen Navigation
        function showLoginScreen() {
            const loginScreen = document.getElementById('loginScreen');
            const registerScreen = document.getElementById('registerScreen');
            const codeScreen = document.getElementById('codeActivationScreen');
            
            if (loginScreen) loginScreen.classList.remove('hidden');
            if (registerScreen) registerScreen.classList.add('hidden');
            if (codeScreen) codeScreen.classList.add('hidden');
        }
        
        function showRegisterScreen() {
            const loginScreen = document.getElementById('loginScreen');
            const registerScreen = document.getElementById('registerScreen');
            const codeScreen = document.getElementById('codeActivationScreen');
            
            if (loginScreen) loginScreen.classList.add('hidden');
            if (registerScreen) registerScreen.classList.remove('hidden');
            if (codeScreen) codeScreen.classList.add('hidden');
        }
        
        function showCodeActivationScreen() {
            const loginScreen = document.getElementById('loginScreen');
            const registerScreen = document.getElementById('registerScreen');
            const codeScreen = document.getElementById('codeActivationScreen');
            
            if (loginScreen) loginScreen.classList.add('hidden');
            if (registerScreen) registerScreen.classList.add('hidden');
            if (codeScreen) codeScreen.classList.remove('hidden');
        }
        
        function backToUserLogin() {
            window.location.hash = '';
            isAdmin = false;
            localStorage.removeItem('currentAdmin');
            showAuthScreens();
        }
        
        function goToAdminPanel() {
            window.location.hash = '#admin';
            showAdminPanel();
        }
        
        // Utility Functions
        function generate12DigitCode() {
            return Math.floor(100000000000 + Math.random() * 900000000000).toString();
        }
        
        function saveSystemData() {
            try {
                localStorage.setItem('systemUsers', JSON.stringify(users));
                localStorage.setItem('pendingRegistrations', JSON.stringify(pendingRegistrations));
                console.log('System data saved successfully');
            } catch (e) {
                console.error('Error saving system data:', e);
            }
        }
        
        // Event Listeners Setup
        function setupEventListeners() {
            // Registration Form
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', handleRegistration);
            }
            
            // Code Activation Form
            const codeForm = document.getElementById('codeActivationForm');
            if (codeForm) {
                codeForm.addEventListener('submit', handleCodeActivation);
            }
            
            // Login Form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleUserLogin);
            }
            
            // Admin Login Form
            const adminLoginForm = document.getElementById('adminLoginForm');
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', handleAdminLogin);
            }
        }
        
        // Registration Handler
        function handleRegistration(e) {
            e.preventDefault();
            console.log('Handling registration...');
            
            const name = document.getElementById('registerName').value.trim();
            const phone = document.getElementById('registerPhone').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            
            // Validation
            if (!name) {
                alert('لطفاً نام و نام خانوادگی را وارد کنید');
                return;
            }
            
            if (!phone || !/^09\d{9}$/.test(phone)) {
                alert('شماره تلفن باید با 09 شروع شده و 11 رقم باشد');
                return;
            }
            
            // Check for duplicate phone
            const existingPending = pendingRegistrations.find(r => r.phone === phone);
            const existingUser = users.find(u => u.phone === phone);
            
            if (existingPending || existingUser) {
                alert('این شماره تلفن قبلاً ثبت شده است');
                return;
            }
            
            // Create registration
            const registration = {
                id: Date.now(),
                name: name,
                phone: phone,
                email: email || '',
                registrationDate: new Date().toLocaleDateString('fa-IR'),
                status: 'pending',
                code: generate12DigitCode()
            };
            
            // Save registration
            pendingRegistrations.push(registration);
            saveSystemData();
            
            // Show success message
            alert(`✅ درخواست ثبت نام شما با موفقیت ارسال شد!

📋 اطلاعات شما:
👤 نام: ${name}
📱 تلفن: ${phone}
🔑 کد شما: ${registration.code}

⏳ لطفاً منتظر تایید مدیر باشید.
پس از تایید، می‌توانید با کد بالا وارد شوید.`);
            
            // Reset form and go to login
            document.getElementById('registerForm').reset();
            showLoginScreen();
        }
        
        // Code Activation Handler
        function handleCodeActivation(e) {
            e.preventDefault();
            console.log('Handling code activation...');
            
            const code = document.getElementById('activationCode').value.trim();
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validation
            if (!code || code.length !== 12) {
                alert('کد باید 12 رقم باشد');
                return;
            }
            
            if (!password || password.length < 6) {
                alert('رمز عبور باید حداقل 6 کاراکتر باشد');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('رمز عبور و تکرار آن یکسان نیستند');
                return;
            }
            
            // Find user with this code
            const user = users.find(u => u.code === code && u.status === 'approved' && !u.password);
            
            if (!user) {
                alert('کد وارد شده معتبر نیست یا قبلاً فعال شده است');
                return;
            }
            
            // Activate user
            user.password = password;
            user.status = 'active';
            user.activationDate = new Date().toLocaleDateString('fa-IR');
            
            saveSystemData();
            
            alert('✅ حساب شما با موفقیت فعال شد! اکنون می‌توانید وارد شوید.');
            
            // Reset form and show login
            document.getElementById('codeActivationForm').reset();
            showLoginScreen();
        }
        
        // User Login Handler
        function handleUserLogin(e) {
            e.preventDefault();
            console.log('Handling user login...');
            
            const code = document.getElementById('loginCode').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!code || !password) {
                alert('لطفاً کد و رمز عبور را وارد کنید');
                return;
            }
            
            const user = users.find(u => u.code === code && u.password === password);
            
            if (!user) {
                alert('کد یا رمز عبور اشتباه است');
                return;
            }
            
            if (user.status === 'suspended') {
                alert('حساب شما موقتاً مسدود شده است. لطفاً با مدیر تماس بگیرید.');
                return;
            }
            
            if (user.status !== 'active') {
                alert('حساب شما هنوز فعال نشده است');
                return;
            }
            
            // Login successful
            currentUser = user;
            user.lastLogin = new Date().toLocaleDateString('fa-IR');
            
            localStorage.setItem('currentUser', JSON.stringify(user));
            saveSystemData();
            
            console.log('User logged in successfully:', user.name);
            showMainApp();
        }
        
        // Admin Login Handler
        function handleAdminLogin(e) {
            e.preventDefault();
            console.log('Handling admin login...');
            
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdmin = true;
                localStorage.setItem('currentAdmin', 'true');
                console.log('Admin logged in successfully');
                showAdminDashboard();
            } else {
                alert('نام کاربری یا رمز عبور مدیر اشتباه است');
            }
        }
        
        // Logout Functions
        function userLogout() {
            if (confirm('آیا می‌خواهید از حساب خود خارج شوید؟')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showAuthScreens();
            }
        }
        
        function adminLogout() {
            if (confirm('آیا می‌خواهید از پنل مدیریت خارج شوید؟')) {
                isAdmin = false;
                localStorage.removeItem('currentAdmin');
                showAdminPanel();
            }
        }
        
        // Admin Functions
        function refreshAdminData() {
            console.log('Refreshing admin data...');
            loadSystemData();
            updateAdminStats();
            renderPendingRegistrations();
            renderUsersList();
            renderSubscriptionsList();
            updateSubscriptionUserSelect();
        }
        
        function updateAdminStats() {
            const totalUsersCount = users.length;
            const activeUsersCount = users.filter(u => u.status === 'active').length;
            const pendingUsersCount = pendingRegistrations.length;
            const blockedUsersCount = users.filter(u => u.status === 'suspended').length;
            
            const totalUsersEl = document.getElementById('totalUsers');
            const activeUsersEl = document.getElementById('activeUsers');
            const pendingUsersEl = document.getElementById('pendingUsers');
            const blockedUsersEl = document.getElementById('blockedUsers');
            
            if (totalUsersEl) totalUsersEl.textContent = totalUsersCount;
            if (activeUsersEl) activeUsersEl.textContent = activeUsersCount;
            if (pendingUsersEl) pendingUsersEl.textContent = pendingUsersCount;
            if (blockedUsersEl) blockedUsersEl.textContent = blockedUsersCount;
        }
        
        function renderPendingRegistrations() {
            const container = document.getElementById('pendingRegistrations');
            if (!container) return;
            
            if (pendingRegistrations.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-6xl">📝</span>
                        <p class="mt-4 text-lg">درخواست جدیدی وجود ندارد</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pendingRegistrations.map(registration => `
                <div class="border border-yellow-200 rounded-lg p-4 mb-4 bg-yellow-50">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg text-gray-800">${registration.name}</h3>
                            <p class="text-gray-600">📱 ${registration.phone}</p>
                            <p class="text-gray-600">📧 ${registration.email || 'ندارد'}</p>
                            <p class="text-gray-500 text-sm">📅 ${registration.registrationDate}</p>
                            <p class="text-blue-600 font-mono text-sm">🔑 کد: ${registration.code}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="approveRegistration(${registration.id})" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
                                ✅ تایید
                            </button>
                            <button onclick="rejectRegistration(${registration.id})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all">
                                ❌ رد
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderUsersList() {
            const container = document.getElementById('usersList');
            if (!container) return;
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-6xl">👤</span>
                        <p class="mt-4 text-lg">کاربری وجود ندارد</p>
                    </div>
                `;
                return;
            }
            
            const statusColors = {
                'active': 'bg-green-100 text-green-800',
                'approved': 'bg-blue-100 text-blue-800',
                'suspended': 'bg-red-100 text-red-800'
            };
            
            const statusTexts = {
                'active': 'فعال',
                'approved': 'تایید شده',
                'suspended': 'مسدود'
            };
            
            container.innerHTML = users.map(user => `
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg text-gray-800">${user.name}</h3>
                            <p class="text-gray-600">📱 ${user.phone}</p>
                            <p class="text-gray-600">📧 ${user.email || 'ندارد'}</p>
                            <p class="text-gray-500 text-sm">📅 ثبت نام: ${user.registrationDate}</p>
                            <p class="text-gray-500 text-sm">🔑 کد: ${user.code}</p>
                            ${user.lastLogin ? `<p class="text-gray-500 text-sm">🕐 آخرین ورود: ${user.lastLogin}</p>` : ''}
                            <span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${statusColors[user.status] || 'bg-gray-100 text-gray-800'}">
                                ${statusTexts[user.status] || user.status}
                            </span>
                        </div>
                        <div class="flex gap-2 flex-col">
                            ${user.status === 'active' ? 
                                `<button onclick="suspendUser(${user.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-all">
                                    🚫 مسدود
                                </button>` :
                                user.status === 'suspended' ?
                                `<button onclick="activateUser(${user.id})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-all">
                                    ✅ فعال
                                </button>` : ''
                            }
                            <button onclick="deleteUser(${user.id})" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-all">
                                🗑️ حذف
                            </button>
                            <button onclick="resetUserPassword(${user.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-all">
                                🔄 ریست رمز
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Admin Action Functions
        function approveRegistration(id) {
            console.log('Approving registration:', id);
            const registration = pendingRegistrations.find(r => r.id === id);
            if (!registration) {
                alert('درخواست یافت نشد');
                return;
            }
            
            const user = {
                id: Date.now(),
                name: registration.name,
                phone: registration.phone,
                email: registration.email,
                code: registration.code,
                registrationDate: registration.registrationDate,
                approvalDate: new Date().toLocaleDateString('fa-IR'),
                status: 'approved',
                password: null,
                lastLogin: null
            };
            
            users.push(user);
            pendingRegistrations = pendingRegistrations.filter(r => r.id !== id);
            saveSystemData();
            
            alert(`✅ کاربر ${registration.name} تایید شد!

🔑 کد فعال‌سازی: ${registration.code}

این کد را به کاربر ارسال کنید تا بتواند حساب خود را فعال کند.`);
            
            refreshAdminData();
        }
        
        function rejectRegistration(id) {
            if (confirm('آیا از رد این درخواست اطمینان دارید؟')) {
                pendingRegistrations = pendingRegistrations.filter(r => r.id !== id);
                saveSystemData();
                refreshAdminData();
            }
        }
        
        function suspendUser(id) {
            if (confirm('آیا می‌خواهید این کاربر را مسدود کنید؟')) {
                const user = users.find(u => u.id === id);
                if (user) {
                    user.status = 'suspended';
                    saveSystemData();
                    refreshAdminData();
                }
            }
        }
        
        function activateUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                user.status = 'active';
                saveSystemData();
                refreshAdminData();
            }
        }
        
        function deleteUser(id) {
            if (confirm('آیا از حذف این کاربر اطمینان دارید؟ تمام داده‌های او حذف خواهد شد.')) {
                const user = users.find(u => u.id === id);
                if (user) {
                    localStorage.removeItem(`userData_${user.id}`);
                    users = users.filter(u => u.id !== id);
                    saveSystemData();
                    refreshAdminData();
                }
            }
        }
        
        function resetUserPassword(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                user.password = null;
                user.status = 'approved';
                saveSystemData();
                
                alert(`🔄 رمز عبور کاربر ${user.name} ریست شد.

🔑 کد فعال‌سازی: ${user.code}

کاربر باید مجدداً رمز عبور تنظیم کند.`);
                
                refreshAdminData();
            }
        }
        
        // Update subscription user select
        function updateSubscriptionUserSelect() {
            const select = document.getElementById('subscriptionUserId');
            if (!select) return;
            
            select.innerHTML = '<option value="">کاربر را انتخاب کنید</option>' +
                users.filter(u => u.status === 'active').map(user => 
                    `<option value="${user.id}">${user.name} (${user.phone})</option>`
                ).join('');
        }
        
        // Activate user subscription
        function activateUserSubscription() {
            const userId = document.getElementById('subscriptionUserId').value;
            const subscriptionType = document.getElementById('subscriptionType').value;
            
            if (!userId || !subscriptionType) {
                alert('لطفاً کاربر و نوع اشتراک را انتخاب کنید');
                return;
            }
            
            const user = users.find(u => u.id == userId);
            if (!user) {
                alert('کاربر یافت نشد');
                return;
            }
            
            const plans = {
                '1month': { name: 'یک ماهه', duration: 30, price: '۹۹ تومان' },
                '3month': { name: 'سه ماهه', duration: 90, price: '۱۹۹ تومان' },
                '6month': { name: 'شش ماهه', duration: 180, price: '۳۹۹ تومان' },
                '12month': { name: 'یک ساله', duration: 365, price: '۵۹۹ تومان' },
                '5year': { name: 'پنج ساله', duration: 1825, price: '۱,۵۰۰ تومان' },
                'lifetime': { name: 'نامحدود', duration: 36500, price: '۳,۰۰۰ تومان' }
            };
            
            const selectedPlan = plans[subscriptionType];
            const now = new Date().getTime();
            
            // Create subscription data for user
            const userSubKey = `subscription_${userId}`;
            const subscriptionData = {
                installDate: now,
                subscriptionType: subscriptionType,
                expiryDate: subscriptionType === 'lifetime' ? 
                    now + (36500 * 24 * 60 * 60 * 1000) : 
                    now + (selectedPlan.duration * 24 * 60 * 60 * 1000),
                isActive: true,
                userId: parseInt(userId),
                activatedBy: 'admin',
                activationDate: new Date().toLocaleDateString('fa-IR')
            };
            
            localStorage.setItem(userSubKey, JSON.stringify(subscriptionData));
            
            alert(`✅ اشتراک ${selectedPlan.name} برای کاربر ${user.name} فعال شد!

💰 قیمت: ${selectedPlan.price}
⏰ مدت: ${selectedPlan.name}
📅 تاریخ فعال‌سازی: ${subscriptionData.activationDate}`);
            
            // Reset form
            document.getElementById('subscriptionUserId').value = '';
            document.getElementById('subscriptionType').value = '';
            
            refreshAdminData();
        }
        
        // Render subscriptions list
        function renderSubscriptionsList() {
            const container = document.getElementById('subscriptionsList');
            if (!container) return;
            
            const activeSubscriptions = [];
            
            // Get all active subscriptions
            users.forEach(user => {
                const userSubKey = `subscription_${user.id}`;
                const subData = JSON.parse(localStorage.getItem(userSubKey) || '{}');
                
                if (subData.isActive && subData.subscriptionType !== 'trial') {
                    activeSubscriptions.push({
                        user: user,
                        subscription: subData
                    });
                }
            });
            
            if (activeSubscriptions.length === 0) {
                container.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">لیست اشتراک‌های فعال</h3>
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-6xl">💎</span>
                        <p class="mt-4 text-lg">اشتراک فعالی وجود ندارد</p>
                    </div>
                `;
                return;
            }
            
            const plans = {
                '1month': { name: 'یک ماهه', price: '۹۹ تومان' },
                '3month': { name: 'سه ماهه', price: '۱۹۹ تومان' },
                '6month': { name: 'شش ماهه', price: '۳۹۹ تومان' },
                '12month': { name: 'یک ساله', price: '۵۹۹ تومان' },
                '5year': { name: 'پنج ساله', price: '۱,۵۰۰ تومان' },
                'lifetime': { name: 'نامحدود', price: '۳,۰۰۰ تومان' }
            };
            
            container.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-700 mb-4">لیست اشتراک‌های فعال (${activeSubscriptions.length} مورد)</h3>
                <div class="space-y-4">
                    ${activeSubscriptions.map(item => {
                        const plan = plans[item.subscription.subscriptionType];
                        const expiryDate = new Date(item.subscription.expiryDate).toLocaleDateString('fa-IR');
                        const remainingDays = Math.max(0, Math.ceil((item.subscription.expiryDate - new Date().getTime()) / (24 * 60 * 60 * 1000)));
                        
                        return `
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-800">${item.user.name}</h4>
                                        <p class="text-gray-600">📱 ${item.user.phone}</p>
                                        <p class="text-green-600 font-medium">💎 ${plan.name} (${plan.price})</p>
                                        <p class="text-gray-500 text-sm">📅 فعال‌سازی: ${item.subscription.activationDate}</p>
                                        ${item.subscription.subscriptionType !== 'lifetime' ? 
                                            `<p class="text-gray-500 text-sm">⏰ انقضا: ${expiryDate} (${remainingDays} روز باقی‌مانده)</p>` :
                                            `<p class="text-green-600 text-sm">♾️ نامحدود - بدون انقضا</p>`
                                        }
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="extendUserSubscription(${item.user.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-all">
                                            ⏰ تمدید
                                        </button>
                                        <button onclick="cancelUserSubscription(${item.user.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-all">
                                            ❌ لغو
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        // Extend user subscription
        function extendUserSubscription(userId) {
            const user = users.find(u => u.id == userId);
            if (!user) return;
            
            const userSubKey = `subscription_${userId}`;
            const subData = JSON.parse(localStorage.getItem(userSubKey) || '{}');
            
            if (!subData.isActive) {
                alert('اشتراک این کاربر فعال نیست');
                return;
            }
            
            const extensionDays = prompt('چند روز به اشتراک اضافه شود؟', '30');
            if (!extensionDays || isNaN(extensionDays) || extensionDays <= 0) {
                return;
            }
            
            const additionalTime = parseInt(extensionDays) * 24 * 60 * 60 * 1000;
            subData.expiryDate += additionalTime;
            
            localStorage.setItem(userSubKey, JSON.stringify(subData));
            
            alert(`✅ اشتراک کاربر ${user.name} به مدت ${extensionDays} روز تمدید شد!`);
            
            refreshAdminData();
        }
        
        // Cancel user subscription
        function cancelUserSubscription(userId) {
            const user = users.find(u => u.id == userId);
            if (!user) return;
            
            if (confirm(`آیا از لغو اشتراک کاربر ${user.name} اطمینان دارید؟`)) {
                const userSubKey = `subscription_${userId}`;
                const subData = JSON.parse(localStorage.getItem(userSubKey) || '{}');
                
                subData.isActive = false;
                subData.cancelDate = new Date().toLocaleDateString('fa-IR');
                subData.canceledBy = 'admin';
                
                localStorage.setItem(userSubKey, JSON.stringify(subData));
                
                alert(`❌ اشتراک کاربر ${user.name} لغو شد`);
                
                refreshAdminData();
            }
        }
        
        // User Data Functions
        function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDataKey = `userData_${currentUser.id}`;
                const userData = JSON.parse(localStorage.getItem(userDataKey) || '{}');
                
                people = userData.people || [];
                transactions = userData.transactions || [];
                
                setTimeout(() => {
                    if (typeof renderPeople === 'function') renderPeople();
                    if (typeof renderTransactions === 'function') renderTransactions();
                    if (typeof updateTransactionSelect === 'function') updateTransactionSelect();
                    if (typeof updateSummary === 'function') updateSummary();
                    if (typeof updateCharts === 'function') updateCharts();
                    if (typeof renderIndividualTables === 'function') renderIndividualTables();
                    if (typeof updateTrialStatus === 'function') updateTrialStatus();
                }, 100);
            } catch (error) {
                console.error('Error loading user data:', error);
                people = [];
                transactions = [];
            }
        }
        
        function saveUserData() {
            if (!currentUser) return;
            
            const userDataKey = `userData_${currentUser.id}`;
            const userData = {
                people: people,
                transactions: transactions
            };
            
            localStorage.setItem(userDataKey, JSON.stringify(userData));
        }
        
        // Override saveData to use user-specific storage
        function saveData() {
            saveUserData();
            updateSummary();
            updateCharts();
            renderIndividualTables();
        }

        // Subscription Management
        const TRIAL_DAYS = 7;
        
        // Get user-specific subscription data
        function getUserSubscriptionData() {
            if (!currentUser) return null;
            const userSubKey = `subscription_${currentUser.id}`;
            let subscriptionData = JSON.parse(localStorage.getItem(userSubKey) || '{}');
            
            // Initialize subscription data if not exists for this user
            if (!subscriptionData.installDate) {
                subscriptionData = {
                    installDate: new Date().getTime(),
                    subscriptionType: 'trial',
                    expiryDate: new Date().getTime() + (TRIAL_DAYS * 24 * 60 * 60 * 1000),
                    isActive: true,
                    userId: currentUser.id
                };
                localStorage.setItem(userSubKey, JSON.stringify(subscriptionData));
            }
            
            return subscriptionData;
        }
        
        // Save user subscription data
        function saveUserSubscriptionData(data) {
            if (!currentUser) return;
            const userSubKey = `subscription_${currentUser.id}`;
            localStorage.setItem(userSubKey, JSON.stringify(data));
        }

        // Check subscription status
        function checkSubscriptionStatus() {
            const subscriptionData = getUserSubscriptionData();
            if (!subscriptionData) return false;
            
            const now = new Date().getTime();
            const isExpired = now > subscriptionData.expiryDate;
            
            if (isExpired && subscriptionData.subscriptionType === 'trial') {
                subscriptionData.isActive = false;
                saveUserSubscriptionData(subscriptionData);
                showSubscriptionModal();
                return false;
            }
            
            return subscriptionData.isActive;
        }

        // Get remaining trial days
        function getRemainingTrialDays() {
            const subscriptionData = getUserSubscriptionData();
            if (!subscriptionData) return 0;
            
            const now = new Date().getTime();
            const remaining = Math.max(0, Math.ceil((subscriptionData.expiryDate - now) / (24 * 60 * 60 * 1000)));
            return remaining;
        }

        // Show subscription modal
        function showSubscriptionModal() {
            showModal('subscriptionModal');
        }

        // Show user subscription modal
        function showUserSubscriptionModal() {
            updateCurrentSubscriptionStatus();
            showModal('userSubscriptionModal');
        }

        // Update current subscription status
        function updateCurrentSubscriptionStatus() {
            const statusElement = document.getElementById('currentSubscriptionStatus');
            if (!statusElement) return;
            
            const subscriptionData = getUserSubscriptionData();
            if (!subscriptionData) return;
            
            const remainingDays = getRemainingTrialDays();
            
            if (subscriptionData.subscriptionType === 'trial') {
                if (remainingDays > 0) {
                    statusElement.innerHTML = `
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl ml-2">⏰</span>
                            <h3 class="text-xl font-bold text-blue-800">دوره آزمایشی فعال</h3>
                        </div>
                        <p class="text-blue-700">شما ${remainingDays} روز از دوره آزمایشی باقی‌مانده دارید</p>
                        <p class="text-blue-600 text-sm mt-2">برای ادامه استفاده پس از اتمام دوره آزمایشی، یکی از پلان‌های زیر را انتخاب کنید</p>
                    `;
                    statusElement.className = 'bg-gradient-to-r from-blue-100 to-blue-200 border border-blue-300 rounded-lg p-4 mb-6';
                } else {
                    statusElement.innerHTML = `
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl ml-2">⏰</span>
                            <h3 class="text-xl font-bold text-red-800">دوره آزمایشی به پایان رسید!</h3>
                        </div>
                        <p class="text-red-700">برای ادامه استفاده از تمامی امکانات، لطفاً یکی از پلان‌های زیر را انتخاب کنید</p>
                    `;
                    statusElement.className = 'bg-gradient-to-r from-red-100 to-red-200 border border-red-300 rounded-lg p-4 mb-6';
                }
            } else {
                const plans = {
                    '1month': 'یک ماهه',
                    '3month': 'سه ماهه', 
                    '6month': 'شش ماهه',
                    '12month': 'یک ساله',
                    '5year': 'پنج ساله',
                    'lifetime': 'نامحدود'
                };
                
                const planName = plans[subscriptionData.subscriptionType] || 'فعال';
                const expiryDate = subscriptionData.subscriptionType === 'lifetime' ? 
                    'بدون انقضا' : 
                    new Date(subscriptionData.expiryDate).toLocaleDateString('fa-IR');
                
                statusElement.innerHTML = `
                    <div class="flex items-center justify-center mb-2">
                        <span class="text-3xl ml-2">✅</span>
                        <h3 class="text-xl font-bold text-green-800">اشتراک ${planName} فعال</h3>
                    </div>
                    <p class="text-green-700">اشتراک شما فعال است و از تمامی امکانات می‌توانید استفاده کنید</p>
                    <p class="text-green-600 text-sm mt-2">انقضا: ${expiryDate}</p>
                `;
                statusElement.className = 'bg-gradient-to-r from-green-100 to-green-200 border border-green-300 rounded-lg p-4 mb-6';
            }
        }

        // Purchase user subscription
        function purchaseUserSubscription(planType) {
            const plans = {
                '1month': { name: 'یک ماهه', price: '۹۹ تومان', duration: 30 },
                '3month': { name: 'سه ماهه', price: '۱۹۹ تومان', duration: 90 },
                '6month': { name: 'شش ماهه', price: '۳۹۹ تومان', duration: 180 },
                '12month': { name: 'یک ساله', price: '۵۹۹ تومان', duration: 365 },
                '5year': { name: 'پنج ساله', price: '۱,۵۰۰ تومان', duration: 1825 },
                'lifetime': { name: 'نامحدود', price: '۳,۰۰۰ تومان', duration: 36500 }
            };
            
            const selectedPlan = plans[planType];
            const userInfo = currentUser ? `نام: ${currentUser.name}\nتلفن: ${currentUser.phone}\nکد کاربری: ${currentUser.code}` : '';
            const message = `سلام! می‌خواهم اشتراک ${selectedPlan.name} به قیمت ${selectedPlan.price} را خریداری کنم.

اطلاعات کاربری:
${userInfo}

لطفاً راهنمایی کنید.`;
            
            // Show purchase confirmation modal
            const purchaseModal = document.createElement('div');
            purchaseModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            purchaseModal.innerHTML = `
                <div class="bg-white rounded-xl p-8 max-w-lg mx-4 text-center">
                    <div class="text-6xl mb-4">💎</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">خرید اشتراک ${selectedPlan.name}</h3>
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-lg p-6 mb-6">
                        <div class="text-3xl font-bold text-blue-600 mb-2">${selectedPlan.price}</div>
                        <div class="text-gray-700">مدت اشتراک: ${selectedPlan.name}</div>
                        <div class="text-gray-600 text-sm mt-2">کاربر: ${currentUser ? currentUser.name : 'نامشخص'}</div>
                    </div>
                    
                    <p class="text-gray-600 mb-6">برای خرید این اشتراک، با یکی از راه‌های زیر تماس بگیرید:</p>
                    
                    <div class="grid grid-cols-1 gap-3 mb-6">
                        <button onclick="contactSupportWithMessage('phone', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📞 تماس تلفنی: ۰۹۹۳۶۵۶۵۵۱۰۶
                        </button>
                        <button onclick="contactSupportWithMessage('telegram', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-blue-400 hover:bg-blue-500 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📱 تلگرام: @Spaincar7
                        </button>
                        <button onclick="contactSupportWithMessage('whatsapp', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            💬 واتساپ: ۰۹۱۹۹۷۶۴۱۵۷
                        </button>
                        <button onclick="contactSupportWithMessage('eitaa', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            🔵 ایتا: @Spaincar77
                        </button>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-2xl ml-2">⚡</span>
                            <h4 class="font-bold text-yellow-800">فرآیند خرید:</h4>
                        </div>
                        <ul class="text-yellow-700 text-sm space-y-1">
                            <li>۱. با پشتیبانی تماس بگیرید</li>
                            <li>۲. مبلغ را پرداخت کنید</li>
                            <li>۳. اشتراک فوراً فعال می‌شود</li>
                        </ul>
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg transition-all">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(purchaseModal);
        }



        // Contact support for purchase
        function contactSupportForPurchase(platform) {
            const subscriptionData = getUserSubscriptionData();
            const remainingDays = getRemainingTrialDays();
            const userInfo = currentUser ? `نام: ${currentUser.name}\nتلفن: ${currentUser.phone}\nکد کاربری: ${currentUser.code}` : '';
            
            let message = `سلام! می‌خواهم اشتراک حسابداری خریداری کنم.

اطلاعات کاربری:
${userInfo}

وضعیت فعلی: `;
            
            if (subscriptionData.subscriptionType === 'trial') {
                if (remainingDays > 0) {
                    message += `دوره آزمایشی (${remainingDays} روز باقی‌مانده)`;
                } else {
                    message += `دوره آزمایشی به پایان رسیده`;
                }
            } else {
                const plans = {
                    '1month': 'یک ماهه',
                    '3month': 'سه ماهه', 
                    '6month': 'شش ماهه',
                    '12month': 'یک ساله',
                    '5year': 'پنج ساله',
                    'lifetime': 'نامحدود'
                };
                message += `اشتراک ${plans[subscriptionData.subscriptionType]} فعال`;
            }
            
            message += `\n\nلطفاً راهنمایی کنید.`;
            
            contactSupportWithMessage(platform, message);
        }

        // Block transaction features
        function blockTransactionFeatures() {
            const transactionForm = document.getElementById('transactionForm');
            const personForm = document.getElementById('personForm');
            
            if (transactionForm) {
                transactionForm.style.opacity = '0.5';
                transactionForm.style.pointerEvents = 'none';
            }
            
            if (personForm) {
                personForm.style.opacity = '0.5';
                personForm.style.pointerEvents = 'none';
            }
            
            // Add overlay message
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            overlay.innerHTML = `
                <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center">
                    <div class="text-6xl mb-4">🔒</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">دوره آزمایشی به پایان رسید</h3>
                    <p class="text-gray-600 mb-6">برای ادامه استفاده از امکانات، لطفاً اشتراک تهیه کنید</p>
                    <button onclick="showSubscriptionModal(); this.parentElement.parentElement.remove();" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium">
                        مشاهده پلان‌ها
                    </button>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // Theme Management
        function changeTheme() {
            const theme = document.getElementById('themeSelector').value;
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('selectedTheme', theme);
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'light';
            document.getElementById('themeSelector').value = savedTheme;
            document.body.setAttribute('data-theme', savedTheme);
        }

        // Modal Management
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showHelp() {
            showModal('helpModal');
        }

        function showSupport() {
            showModal('supportModal');
        }

        // Contact Support Functions
        function contactSupport(platform) {
            let contactUrl = '';
            
            switch(platform) {
                case 'phone':
                    contactUrl = 'tel:+989936565106';
                    break;
                case 'telegram':
                    contactUrl = 'https://t.me/Spaincar7';
                    break;
                case 'whatsapp':
                    contactUrl = 'https://wa.me/989199764157';
                    break;
                case 'eitaa':
                    contactUrl = 'https://eitaa.com/Spaincar77';
                    break;
                default:
                    return;
            }
            
            window.open(contactUrl, '_blank');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('accountingPeople', JSON.stringify(people));
            localStorage.setItem('accountingTransactions', JSON.stringify(transactions));
            updateSummary();
            updateCharts();
            renderIndividualTables();
        }

        // Purchase subscription function
        function purchaseSubscription(planType) {
            const plans = {
                '1month': { name: 'یک ماهه', price: '۹۹,۰۰۰ تومان', duration: 30 },
                '3month': { name: 'سه ماهه', price: '۱۹۹,۰۰۰ تومان', duration: 90 },
                '6month': { name: 'شش ماهه', price: '۳۹۹,۰۰۰ تومان', duration: 180 },
                '12month': { name: 'یک ساله', price: '۵۹۹,۰۰۰ تومان', duration: 365 },
                '5year': { name: 'پنج ساله', price: '۱,۵۰۰,۰۰۰ تومان', duration: 1825 },
                'lifetime': { name: 'نامحدود', price: '۳,۰۰۰,۰۰۰ تومان', duration: 36500 }
            };
            
            const selectedPlan = plans[planType];
            const message = `سلام! می‌خواهم اشتراک ${selectedPlan.name} به قیمت ${selectedPlan.price} را خریداری کنم.`;
            
            // Show purchase confirmation modal
            const purchaseModal = document.createElement('div');
            purchaseModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            purchaseModal.innerHTML = `
                <div class="bg-white rounded-xl p-8 max-w-lg mx-4 text-center">
                    <div class="text-6xl mb-4">💎</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">خرید اشتراک ${selectedPlan.name}</h3>
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-lg p-6 mb-6">
                        <div class="text-3xl font-bold text-blue-600 mb-2">${selectedPlan.price}</div>
                        <div class="text-gray-700">مدت اشتراک: ${selectedPlan.name}</div>
                    </div>
                    
                    <p class="text-gray-600 mb-6">برای خرید این اشتراک، با یکی از راه‌های زیر تماس بگیرید:</p>
                    
                    <div class="grid grid-cols-1 gap-3 mb-6">
                        <button onclick="contactSupportWithMessage('phone', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📞 تماس تلفنی: ۰۹۹۳۶۵۶۵۵۱۰۶
                        </button>
                        <button onclick="contactSupportWithMessage('telegram', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-blue-400 hover:bg-blue-500 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            📱 تلگرام: @Spaincar7
                        </button>
                        <button onclick="contactSupportWithMessage('whatsapp', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            💬 واتساپ: ۰۹۱۹۹۷۶۴۱۵۷
                        </button>
                        <button onclick="contactSupportWithMessage('eitaa', '${message}'); this.parentElement.parentElement.parentElement.remove();" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition-all flex items-center justify-center">
                            🔵 ایتا: @Spaincar77
                        </button>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-2xl ml-2">⚡</span>
                            <h4 class="font-bold text-yellow-800">فرآیند خرید:</h4>
                        </div>
                        <ul class="text-yellow-700 text-sm space-y-1">
                            <li>۱. با پشتیبانی تماس بگیرید</li>
                            <li>۲. مبلغ را پرداخت کنید</li>
                            <li>۳. اشتراک فوراً فعال می‌شود</li>
                        </ul>
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg transition-all">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(purchaseModal);
        }



        // Contact support with pre-filled message
        function contactSupportWithMessage(platform, message) {
            const encodedMessage = encodeURIComponent(message);
            let contactUrl = '';
            
            switch(platform) {
                case 'phone':
                    contactUrl = 'tel:+989936565106';
                    break;
                case 'telegram':
                    contactUrl = `https://t.me/Spaincar7?text=${encodedMessage}`;
                    break;
                case 'whatsapp':
                    contactUrl = `https://wa.me/989199764157?text=${encodedMessage}`;
                    break;
                case 'eitaa':
                    contactUrl = `https://eitaa.com/Spaincar77?text=${encodedMessage}`;
                    break;
                default:
                    return;
            }
            
            window.open(contactUrl, '_blank');
        }

        // Update trial status display
        function updateTrialStatus() {
            const trialStatusElement = document.getElementById('trialStatus');
            if (!trialStatusElement) return;
            
            const subscriptionData = getUserSubscriptionData();
            if (!subscriptionData) return;
            
            const remainingDays = getRemainingTrialDays();
            
            if (subscriptionData.subscriptionType === 'trial') {
                if (remainingDays > 0) {
                    trialStatusElement.innerHTML = `⏰ آزمایشی: ${remainingDays} روز باقی‌مانده`;
                    trialStatusElement.className = 'bg-yellow-100 border border-yellow-300 rounded-lg px-4 py-2 text-sm font-medium text-yellow-800';
                } else {
                    trialStatusElement.innerHTML = `🔒 دوره آزمایشی پایان یافت`;
                    trialStatusElement.className = 'bg-red-100 border border-red-300 rounded-lg px-4 py-2 text-sm font-medium text-red-800';
                }
            } else {
                const plans = {
                    '1month': 'یک ماهه',
                    '3month': 'سه ماهه', 
                    '6month': 'شش ماهه',
                    '12month': 'یک ساله',
                    '5year': 'پنج ساله',
                    'lifetime': 'نامحدود'
                };
                
                const planName = plans[subscriptionData.subscriptionType] || 'فعال';
                trialStatusElement.innerHTML = `✅ اشتراک ${planName}`;
                trialStatusElement.className = 'bg-green-100 border border-green-300 rounded-lg px-4 py-2 text-sm font-medium text-green-800';
            }
        }

        // Add person
        document.getElementById('personForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Check subscription status before allowing action
            if (!checkSubscriptionStatus()) {
                blockTransactionFeatures();
                return;
            }
            
            const name = document.getElementById('personName').value;
            const phone = document.getElementById('personPhone').value;
            const address = document.getElementById('personAddress').value;
            const photoFile = document.getElementById('personPhoto').files[0];
            
            const person = {
                id: Date.now(),
                name: name,
                phone: phone,
                address: address,
                photo: null,
                balance: 0
            };
            
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    person.photo = e.target.result;
                    people.push(person);
                    saveData();
                    renderPeople();
                    updateTransactionSelect();
                    document.getElementById('personForm').reset();
                };
                reader.readAsDataURL(photoFile);
            } else {
                people.push(person);
                saveData();
                renderPeople();
                updateTransactionSelect();
                document.getElementById('personForm').reset();
            }
        });

        // Add transaction
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Check subscription status before allowing action
            if (!checkSubscriptionStatus()) {
                blockTransactionFeatures();
                return;
            }
            
            const personId = parseInt(document.getElementById('transactionPerson').value);
            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const description = document.getElementById('transactionDescription').value;
            
            const transaction = {
                id: Date.now(),
                personId: personId,
                type: type,
                amount: amount,
                description: description,
                date: new Date().toLocaleDateString('fa-IR')
            };
            
            transactions.push(transaction);
            
            // Update person balance
            const person = people.find(p => p.id === personId);
            if (person) {
                if (type === 'debt') {
                    person.balance -= amount; // We owe them
                } else {
                    person.balance += amount; // They owe us
                }
            }
            
            saveData();
            renderPeople();
            renderTransactions();
            document.getElementById('transactionForm').reset();
        });

        // Render people
        function renderPeople() {
            const peopleList = document.getElementById('peopleList');
            
            if (people.length === 0) {
                peopleList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-6xl">👤</span>
                        <p class="mt-4 text-lg">هنوز شخصی اضافه نشده است</p>
                        <p class="text-sm text-gray-400">از فرم سمت راست شخص جدید اضافه کنید</p>
                    </div>
                `;
                return;
            }
            
            peopleList.innerHTML = people.map(person => {
                const balanceColor = person.balance > 0 ? 'text-green-600' : person.balance < 0 ? 'text-red-600' : 'text-gray-600';
                const balanceIcon = person.balance > 0 ? '📈' : person.balance < 0 ? '📉' : '⚖️';
                const balanceText = person.balance > 0 ? 'طلبکار' : person.balance < 0 ? 'بدهکار' : 'تسویه';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all duration-200 fade-in theme-bg-secondary">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center">
                                    ${person.photo ? 
                                        `<img src="${person.photo}" alt="${person.name}" class="w-full h-full object-cover">` :
                                        `<span class="text-2xl">👤</span>`
                                    }
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg theme-text-primary">${person.name}</h3>
                                    <p class="theme-text-secondary text-sm">${person.phone || 'بدون شماره تلفن'}</p>
                                    <p class="theme-text-secondary text-xs">${person.address || 'بدون آدرس'}</p>
                                </div>
                            </div>
                            <div class="text-left">
                                <div class="flex items-center ${balanceColor} font-bold text-lg">
                                    <span class="ml-2">${balanceIcon}</span>
                                    ${Math.abs(person.balance).toLocaleString()} تومان
                                </div>
                                <p class="text-sm ${balanceColor}">${balanceText}</p>
                                <div class="flex gap-2 mt-2">
                                    <button onclick="generatePersonReport(${person.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-all">
                                        📊 گزارش
                                    </button>
                                    <button onclick="deletePerson(${person.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition-all">
                                        🗑️ حذف
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render transactions
        function renderTransactions() {
            const transactionsList = document.getElementById('transactionsList');
            
            if (transactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-6xl">💸</span>
                        <p class="mt-4 text-lg">هنوز تراکنشی ثبت نشده است</p>
                        <p class="text-sm text-gray-400">از فرم سمت راست تراکنش جدید اضافه کنید</p>
                    </div>
                `;
                return;
            }
            
            const sortedTransactions = [...transactions].reverse();
            
            transactionsList.innerHTML = sortedTransactions.map(transaction => {
                const person = people.find(p => p.id === transaction.personId);
                const typeColor = transaction.type === 'credit' ? 'text-green-600' : 'text-red-600';
                const typeIcon = transaction.type === 'credit' ? '📈' : '📉';
                const typeText = transaction.type === 'credit' ? 'طلبکار' : 'بدهکار';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all duration-200 fade-in">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 space-x-reverse mb-2">
                                    <span class="text-xl">${typeIcon}</span>
                                    <h4 class="font-bold text-gray-800">${person ? person.name : 'شخص حذف شده'}</h4>
                                    <span class="text-sm text-gray-500">${transaction.date}</span>
                                </div>
                                <p class="text-gray-600 text-sm mb-2">${transaction.description || 'بدون توضیحات'}</p>
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <span class="${typeColor} font-bold">${transaction.amount.toLocaleString()} تومان</span>
                                    <span class="text-sm ${typeColor}">(${typeText})</span>
                                </div>
                            </div>
                            <button onclick="deleteTransaction(${transaction.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded text-sm transition-all">
                                🗑️ حذف
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update transaction select
        function updateTransactionSelect() {
            const select = document.getElementById('transactionPerson');
            select.innerHTML = '<option value="">شخص را انتخاب کنید</option>' +
                people.map(person => `<option value="${person.id}">${person.name}</option>`).join('');
        }

        // Update summary
        function updateSummary() {
            const totalCredit = people.reduce((sum, person) => sum + Math.max(0, person.balance), 0);
            const totalDebt = people.reduce((sum, person) => sum + Math.max(0, -person.balance), 0);
            
            document.getElementById('totalCredit').textContent = totalCredit.toLocaleString() + ' تومان';
            document.getElementById('totalDebt').textContent = totalDebt.toLocaleString() + ' تومان';
            document.getElementById('totalPeople').textContent = people.length + ' نفر';
        }

        // Delete person
        function deletePerson(id) {
            if (confirm('آیا از حذف این شخص اطمینان دارید؟')) {
                people = people.filter(p => p.id !== id);
                transactions = transactions.filter(t => t.personId !== id);
                saveData();
                renderPeople();
                renderTransactions();
                updateTransactionSelect();
            }
        }

        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('آیا از حذف این تراکنش اطمینان دارید؟')) {
                const transaction = transactions.find(t => t.id === id);
                if (transaction) {
                    const person = people.find(p => p.id === transaction.personId);
                    if (person) {
                        // Reverse the balance change
                        if (transaction.type === 'debt') {
                            person.balance += transaction.amount;
                        } else {
                            person.balance -= transaction.amount;
                        }
                    }
                }
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                renderPeople();
                renderTransactions();
            }
        }

        // Export to PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Persian date helper
            function toPersianDate(dateStr) {
                return new Date().toLocaleDateString('fa-IR');
            }
            
            // Persian number converter
            function toPersianNumbers(str) {
                const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
                const englishDigits = '0123456789';
                return str.toString().replace(/[0-9]/g, function(w) {
                    return persianDigits[englishDigits.indexOf(w)];
                });
            }
            
            // Add Persian font support
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            
            let yPosition = 35;
            
            // Title with Persian styling
            doc.setTextColor(0, 100, 200);
            doc.text('گزارش کلی حسابداری', 105, yPosition, { align: 'center' });
            yPosition += 30;
            
            // Add decorative line
            doc.setLineWidth(1);
            doc.setDrawColor(0, 100, 200);
            doc.line(30, yPosition, 180, yPosition);
            yPosition += 20;
            
            // Summary section with Persian formatting
            const totalCredit = people.reduce((sum, person) => sum + Math.max(0, person.balance), 0);
            const totalDebt = people.reduce((sum, person) => sum + Math.max(0, -person.balance), 0);
            
            // Summary box
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.rect(20, yPosition - 5, 170, 50);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.setTextColor(0, 150, 0);
            doc.text('خلاصه مالی:', 25, yPosition + 8);
            yPosition += 20;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(14);
            
            // Credit section with Persian numbers
            doc.setTextColor(0, 150, 0);
            doc.text(`کل طلب: ${toPersianNumbers(totalCredit.toLocaleString())} تومان`, 30, yPosition);
            yPosition += 12;
            
            // Debt section with Persian numbers
            doc.setTextColor(200, 0, 0);
            doc.text(`کل بدهی: ${toPersianNumbers(totalDebt.toLocaleString())} تومان`, 30, yPosition);
            yPosition += 12;
            
            // People count with Persian numbers
            doc.setTextColor(0, 0, 0);
            doc.text(`تعداد اشخاص: ${toPersianNumbers(people.length)} نفر`, 30, yPosition);
            yPosition += 25;
            
            // People list section
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.setTextColor(0, 100, 200);
            doc.text('جزئیات اشخاص:', 20, yPosition);
            yPosition += 20;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            
            people.forEach((person, index) => {
                // Check for new page
                if (yPosition > 240) {
                    doc.addPage();
                    yPosition = 30;
                    
                    // Repeat header on new page
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(16);
                    doc.setTextColor(0, 100, 200);
                    doc.text('ادامه جزئیات اشخاص:', 20, yPosition);
                    yPosition += 20;
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(12);
                }
                
                // Person box
                const boxHeight = 45;
                doc.setDrawColor(220, 220, 220);
                doc.setLineWidth(0.3);
                doc.rect(20, yPosition - 5, 170, boxHeight);
                
                // Person header with Persian number
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text(`${toPersianNumbers(index + 1)}. ${person.name}`, 25, yPosition + 5);
                yPosition += 12;
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(11);
                
                // Contact info with Persian text
                if (person.phone) {
                    doc.setTextColor(80, 80, 80);
                    doc.text(`شماره تماس: ${toPersianNumbers(person.phone)}`, 30, yPosition);
                    yPosition += 10;
                }
                
                if (person.address) {
                    doc.setTextColor(80, 80, 80);
                    const addressLines = doc.splitTextToSize(`نشانی: ${person.address}`, 150);
                    doc.text(addressLines, 30, yPosition);
                    yPosition += addressLines.length * 10;
                }
                
                // Balance with Persian numbers and text
                const balanceText = person.balance > 0 ? 
                    `موجودی: ${toPersianNumbers(person.balance.toLocaleString())} تومان (طلبکار)` : 
                    person.balance < 0 ? 
                    `موجودی: ${toPersianNumbers(Math.abs(person.balance).toLocaleString())} تومان (بدهکار)` : 
                    `موجودی: تسویه شده`;
                
                if (person.balance > 0) {
                    doc.setTextColor(0, 150, 0);
                } else if (person.balance < 0) {
                    doc.setTextColor(200, 0, 0);
                } else {
                    doc.setTextColor(100, 100, 100);
                }
                
                doc.setFont('helvetica', 'bold');
                doc.text(balanceText, 30, yPosition);
                doc.setTextColor(0, 0, 0);
                yPosition += 20;
            });
            
            // Add Persian footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                
                // Footer line
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.5);
                doc.line(20, 280, 190, 280);
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(120, 120, 120);
                
                // Persian date and time
                const now = new Date();
                const persianDate = now.toLocaleDateString('fa-IR');
                const persianTime = now.toLocaleTimeString('fa-IR');
                doc.text(`تاریخ تولید گزارش: ${toPersianNumbers(persianDate)} - ساعت: ${toPersianNumbers(persianTime)}`, 20, 285);
                
                // Persian page numbers
                doc.text(`صفحه ${toPersianNumbers(i)} از ${toPersianNumbers(pageCount)}`, 170, 285);
                
                // Report title in footer
                doc.text('گزارش حسابداری', 105, 285, { align: 'center' });
            }
            
            // Save with Persian filename
            const persianDate = new Date().toLocaleDateString('fa-IR').replace(/\//g, '-');
            doc.save(`گزارش-حسابداری-${toPersianNumbers(persianDate)}.pdf`);
        }

        // Share data
        function shareData() {
            const data = {
                people: people,
                transactions: transactions,
                exportDate: new Date().toLocaleDateString('fa-IR')
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'accounting-data.json';
            a.click();
            
            URL.revokeObjectURL(url);
            
            // Also try to use Web Share API if available
            if (navigator.share) {
                navigator.share({
                    title: 'داده‌های حسابداری',
                    text: 'فایل داده‌های حسابداری من',
                    files: [new File([dataBlob], 'accounting-data.json', {type: 'application/json'})]
                }).catch(console.error);
            }
        }

        // Update 3D Charts
        function updateCharts() {
            updatePieChart();
            updateBarChart();
            update3DSurface();
        }

        // Pie Chart for Debt/Credit Distribution
        function updatePieChart() {
            if (people.length === 0) {
                document.getElementById('pieChart').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><span class="text-4xl">📊</span><p class="mr-3">داده‌ای برای نمایش وجود ندارد</p></div>';
                return;
            }

            const debtors = people.filter(p => p.balance < 0);
            const creditors = people.filter(p => p.balance > 0);
            const settled = people.filter(p => p.balance === 0);

            const data = [{
                values: [
                    debtors.reduce((sum, p) => sum + Math.abs(p.balance), 0),
                    creditors.reduce((sum, p) => sum + p.balance, 0),
                    settled.length * 1000 // Just for visualization
                ],
                labels: ['بدهکاران', 'طلبکاران', 'تسویه شده'],
                type: 'pie',
                hole: 0.4,
                marker: {
                    colors: ['#ef4444', '#10b981', '#6b7280']
                },
                textinfo: 'label+percent',
                textposition: 'outside'
            }];

            const layout = {
                title: {
                    text: 'توزیع بدهی و طلب',
                    font: { size: 16 }
                },
                showlegend: true,
                margin: { t: 50, b: 50, l: 50, r: 50 }
            };

            Plotly.newPlot('pieChart', data, layout, {responsive: true});
        }

        // Bar Chart for Individual Balances
        function updateBarChart() {
            if (people.length === 0) {
                document.getElementById('barChart').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><span class="text-4xl">📊</span><p class="mr-3">داده‌ای برای نمایش وجود ندارد</p></div>';
                return;
            }

            const data = [{
                x: people.map(p => p.name),
                y: people.map(p => p.balance),
                type: 'bar',
                marker: {
                    color: people.map(p => p.balance >= 0 ? '#10b981' : '#ef4444')
                },
                text: people.map(p => p.balance.toLocaleString() + ' تومان'),
                textposition: 'auto'
            }];

            const layout = {
                title: {
                    text: 'موجودی هر شخص',
                    font: { size: 16 }
                },
                xaxis: { title: 'اشخاص' },
                yaxis: { title: 'موجودی (تومان)' },
                margin: { t: 50, b: 100, l: 80, r: 50 }
            };

            Plotly.newPlot('barChart', data, layout, {responsive: true});
        }

        // 3D Surface Chart for Transactions Over Time
        function update3DSurface() {
            if (transactions.length === 0) {
                document.getElementById('surface3D').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><span class="text-4xl">📊</span><p class="mr-3">داده‌ای برای نمایش وجود ندارد</p></div>';
                return;
            }

            // Create a 3D scatter plot of transactions
            const data = [{
                x: transactions.map((t, index) => index), // Transaction index
                y: transactions.map(t => t.personId), // Person ID
                z: transactions.map(t => t.amount), // Amount
                mode: 'markers',
                type: 'scatter3d',
                marker: {
                    size: 8,
                    color: transactions.map(t => t.type === 'credit' ? '#10b981' : '#ef4444'),
                    opacity: 0.8
                },
                text: transactions.map(t => {
                    const person = people.find(p => p.id === t.personId);
                    return `${person ? person.name : 'نامشخص'}<br>${t.amount.toLocaleString()} تومان<br>${t.date}`;
                }),
                hovertemplate: '%{text}<extra></extra>'
            }];

            const layout = {
                title: {
                    text: 'نمودار سه بعدی تراکنش‌ها',
                    font: { size: 16 }
                },
                scene: {
                    xaxis: { title: 'ترتیب تراکنش' },
                    yaxis: { title: 'شناسه شخص' },
                    zaxis: { title: 'مبلغ (تومان)' }
                },
                margin: { t: 50, b: 50, l: 50, r: 50 }
            };

            Plotly.newPlot('surface3D', data, layout, {responsive: true});
        }

        // Render Individual Tables
        function renderIndividualTables() {
            const tablesContainer = document.getElementById('individualTables');
            
            if (people.length === 0) {
                tablesContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-6xl">📊</span>
                        <p class="mt-4 text-lg">هنوز شخصی اضافه نشده است</p>
                        <p class="text-sm text-gray-400">پس از افزودن اشخاص، جداول جزئیات نمایش داده می‌شود</p>
                    </div>
                `;
                return;
            }

            tablesContainer.innerHTML = people.map(person => {
                const personTransactions = transactions.filter(t => t.personId === person.id);
                const balanceColor = person.balance > 0 ? 'text-green-600' : person.balance < 0 ? 'text-red-600' : 'text-gray-600';
                const balanceIcon = person.balance > 0 ? '📈' : person.balance < 0 ? '📉' : '⚖️';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-6 mb-6 fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center">
                                    ${person.photo ? 
                                        `<img src="${person.photo}" alt="${person.name}" class="w-full h-full object-cover">` :
                                        `<span class="text-2xl">👤</span>`
                                    }
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800">${person.name}</h3>
                                    <p class="text-gray-600">${person.phone || 'بدون شماره تلفن'}</p>
                                    <p class="text-gray-500 text-sm">${person.address || 'بدون آدرس'}</p>
                                </div>
                            </div>
                            <div class="text-left">
                                <div class="flex items-center ${balanceColor} font-bold text-xl">
                                    <span class="ml-2">${balanceIcon}</span>
                                    ${Math.abs(person.balance).toLocaleString()} تومان
                                </div>
                                <p class="text-sm ${balanceColor}">${person.balance > 0 ? 'طلبکار' : person.balance < 0 ? 'بدهکار' : 'تسویه'}</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="ml-2">📋</span>
                                تاریخچه تراکنش‌ها (${personTransactions.length} تراکنش)
                            </h4>
                            
                            ${personTransactions.length === 0 ? 
                                '<p class="text-gray-500 text-center py-4">هیچ تراکنشی ثبت نشده است</p>' :
                                `<div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead>
                                            <tr class="bg-gray-200 text-gray-700">
                                                <th class="px-4 py-2 text-right rounded-tr-lg">تاریخ</th>
                                                <th class="px-4 py-2 text-right">نوع</th>
                                                <th class="px-4 py-2 text-right">مبلغ</th>
                                                <th class="px-4 py-2 text-right rounded-tl-lg">توضیحات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${personTransactions.map((transaction, index) => `
                                                <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} border-b border-gray-200">
                                                    <td class="px-4 py-3">${transaction.date}</td>
                                                    <td class="px-4 py-3">
                                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                                            transaction.type === 'credit' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                        }">
                                                            ${transaction.type === 'credit' ? '📈 طلبکار' : '📉 بدهکار'}
                                                        </span>
                                                    </td>
                                                    <td class="px-4 py-3 font-medium ${transaction.type === 'credit' ? 'text-green-600' : 'text-red-600'}">
                                                        ${transaction.amount.toLocaleString()} تومان
                                                    </td>
                                                    <td class="px-4 py-3 text-gray-600">
                                                        ${transaction.description || 'بدون توضیحات'}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>`
                            }
                            
                            <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                                <div class="bg-green-100 rounded-lg p-3">
                                    <p class="text-green-800 font-semibold">کل طلب</p>
                                    <p class="text-green-600 font-bold">
                                        ${personTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0).toLocaleString()} تومان
                                    </p>
                                </div>
                                <div class="bg-red-100 rounded-lg p-3">
                                    <p class="text-red-800 font-semibold">کل بدهی</p>
                                    <p class="text-red-600 font-bold">
                                        ${personTransactions.filter(t => t.type === 'debt').reduce((sum, t) => sum + t.amount, 0).toLocaleString()} تومان
                                    </p>
                                </div>
                                <div class="bg-blue-100 rounded-lg p-3">
                                    <p class="text-blue-800 font-semibold">موجودی نهایی</p>
                                    <p class="text-blue-600 font-bold ${balanceColor}">
                                        ${Math.abs(person.balance).toLocaleString()} تومان
                                    </p>
                                </div>
                            </div>
                            
                            <div class="mt-6 flex gap-3 flex-wrap justify-center">
                                <button onclick="downloadIndividualPDF(${person.id})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all flex items-center">
                                    📄 دانلود PDF
                                </button>
                                <button onclick="shareIndividualReport(${person.id}, 'telegram')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all flex items-center">
                                    📱 تلگرام
                                </button>
                                <button onclick="shareIndividualReport(${person.id}, 'whatsapp')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all flex items-center">
                                    💬 واتساپ
                                </button>
                                <button onclick="shareIndividualReport(${person.id}, 'eitaa')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-all flex items-center">
                                    🔵 ایتا
                                </button>
                                <button onclick="shareIndividualReport(${person.id}, 'sms')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-all flex items-center">
                                    📨 پیامک
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Generate Person Report
        function generatePersonReport(personId) {
            const person = people.find(p => p.id === personId);
            if (!person) return;

            currentPersonReport = person;
            const personTransactions = transactions.filter(t => t.personId === personId);
            
            const totalCredit = personTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0);
            const totalDebt = personTransactions.filter(t => t.type === 'debt').reduce((sum, t) => sum + t.amount, 0);
            
            const reportContent = `
                <div class="space-y-6">
                    <div class="text-center">
                        <div class="w-24 h-24 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center mx-auto mb-4">
                            ${person.photo ? 
                                `<img src="${person.photo}" alt="${person.name}" class="w-full h-full object-cover">` :
                                `<span class="text-4xl">👤</span>`
                            }
                        </div>
                        <h3 class="text-2xl font-bold theme-text-primary">${person.name}</h3>
                        <p class="theme-text-secondary">${person.phone || 'بدون شماره تلفن'}</p>
                        <p class="theme-text-secondary text-sm">${person.address || 'بدون آدرس'}</p>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="bg-green-100 rounded-lg p-4">
                            <p class="text-green-800 font-semibold">کل طلب</p>
                            <p class="text-green-600 font-bold text-lg">${totalCredit.toLocaleString()} تومان</p>
                        </div>
                        <div class="bg-red-100 rounded-lg p-4">
                            <p class="text-red-800 font-semibold">کل بدهی</p>
                            <p class="text-red-600 font-bold text-lg">${totalDebt.toLocaleString()} تومان</p>
                        </div>
                        <div class="bg-blue-100 rounded-lg p-4">
                            <p class="text-blue-800 font-semibold">موجودی نهایی</p>
                            <p class="text-blue-600 font-bold text-lg ${person.balance >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${Math.abs(person.balance).toLocaleString()} تومان
                            </p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">تاریخچه تراکنش‌ها</h4>
                        ${personTransactions.length === 0 ? 
                            '<p class="text-center theme-text-secondary py-4">هیچ تراکنشی ثبت نشده است</p>' :
                            `<div class="space-y-3 max-h-60 overflow-y-auto">
                                ${personTransactions.map(transaction => `
                                    <div class="border rounded-lg p-3 ${transaction.type === 'credit' ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="font-medium ${transaction.type === 'credit' ? 'text-green-800' : 'text-red-800'}">
                                                    ${transaction.type === 'credit' ? '📈 طلبکار' : '📉 بدهکار'}
                                                </p>
                                                <p class="text-sm text-gray-600">${transaction.description || 'بدون توضیحات'}</p>
                                            </div>
                                            <div class="text-left">
                                                <p class="font-bold ${transaction.type === 'credit' ? 'text-green-600' : 'text-red-600'}">
                                                    ${transaction.amount.toLocaleString()} تومان
                                                </p>
                                                <p class="text-xs text-gray-500">${transaction.date}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>`
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('personReportContent').innerHTML = reportContent;
            showModal('personReportModal');
        }

        // Download Person PDF
        function downloadPersonPDF() {
            if (!currentPersonReport) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const person = currentPersonReport;
            const personTransactions = transactions.filter(t => t.personId === person.id);
            
            // Persian date helper
            function toPersianDate(dateStr) {
                return new Date(dateStr).toLocaleDateString('fa-IR');
            }
            
            // Persian number converter
            function toPersianNumbers(str) {
                const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
                const englishDigits = '0123456789';
                return str.toString().replace(/[0-9]/g, function(w) {
                    return persianDigits[englishDigits.indexOf(w)];
                });
            }
            
            // Header with Persian formatting
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            doc.setTextColor(0, 100, 200);
            doc.text(`گزارش فردی - ${person.name}`, 105, 30, { align: 'center' });
            
            let yPosition = 50;
            
            // Add decorative line
            doc.setLineWidth(1);
            doc.setDrawColor(0, 100, 200);
            doc.line(30, yPosition, 180, yPosition);
            yPosition += 20;
            
            // Personal Information Section with box
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.rect(20, yPosition - 5, 170, 40);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(0, 100, 200);
            doc.text('اطلاعات شخصی:', 25, yPosition + 8);
            yPosition += 18;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            if (person.phone) {
                doc.text(`شماره تماس: ${toPersianNumbers(person.phone)}`, 30, yPosition);
                yPosition += 12;
            }
            
            if (person.address) {
                const addressLines = doc.splitTextToSize(`نشانی: ${person.address}`, 150);
                doc.text(addressLines, 30, yPosition);
                yPosition += addressLines.length * 12;
            }
            
            yPosition += 15;
            
            // Financial Summary Section with box
            doc.setDrawColor(200, 200, 200);
            doc.rect(20, yPosition - 5, 170, 50);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(0, 150, 0);
            doc.text('خلاصه مالی:', 25, yPosition + 8);
            yPosition += 18;
            
            const totalCredit = personTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0);
            const totalDebt = personTransactions.filter(t => t.type === 'debt').reduce((sum, t) => sum + t.amount, 0);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(14);
            
            // Credit with Persian numbers
            doc.setTextColor(0, 150, 0);
            doc.text(`کل طلب: ${toPersianNumbers(totalCredit.toLocaleString())} تومان`, 30, yPosition);
            yPosition += 12;
            
            // Debt with Persian numbers
            doc.setTextColor(200, 0, 0);
            doc.text(`کل بدهی: ${toPersianNumbers(totalDebt.toLocaleString())} تومان`, 30, yPosition);
            yPosition += 12;
            
            // Final balance with Persian numbers
            doc.setFont('helvetica', 'bold');
            const balanceColor = person.balance >= 0 ? [0, 150, 0] : [200, 0, 0];
            doc.setTextColor(...balanceColor);
            doc.text(`موجودی نهایی: ${toPersianNumbers(Math.abs(person.balance).toLocaleString())} تومان (${person.balance >= 0 ? 'طلبکار' : 'بدهکار'})`, 30, yPosition);
            doc.setTextColor(0, 0, 0);
            yPosition += 25;
            
            // Transaction History Section
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 200);
            doc.text(`تاریخچه تراکنش‌ها (${toPersianNumbers(personTransactions.length)} تراکنش):`, 20, yPosition);
            yPosition += 20;
            
            if (personTransactions.length === 0) {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);
                doc.setTextColor(150, 150, 150);
                doc.text('هیچ تراکنشی ثبت نشده است', 30, yPosition);
            } else {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(11);
                
                personTransactions.forEach((transaction, index) => {
                    // Check for new page
                    if (yPosition > 240) {
                        doc.addPage();
                        yPosition = 30;
                        
                        // Repeat header on new page
                        doc.setFont('helvetica', 'bold');
                        doc.setFontSize(14);
                        doc.setTextColor(0, 0, 200);
                        doc.text(`ادامه تراکنش‌های ${person.name}`, 20, yPosition);
                        yPosition += 20;
                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(11);
                    }
                    
                    // Transaction box
                    const boxHeight = transaction.description ? 35 : 25;
                    doc.setDrawColor(220, 220, 220);
                    doc.setLineWidth(0.3);
                    doc.rect(20, yPosition - 3, 170, boxHeight);
                    
                    // Transaction number and date with Persian numbers
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(0, 0, 0);
                    doc.text(`${toPersianNumbers(index + 1)}. تاریخ: ${toPersianNumbers(toPersianDate(transaction.date))}`, 25, yPosition + 5);
                    
                    // Transaction type with Persian text
                    const typeText = transaction.type === 'credit' ? 'طلبکار' : 'بدهکار';
                    const typeColor = transaction.type === 'credit' ? [0, 150, 0] : [200, 0, 0];
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(...typeColor);
                    doc.text(`نوع: ${typeText}`, 25, yPosition + 15);
                    
                    // Amount with Persian numbers
                    doc.setFont('helvetica', 'bold');
                    doc.text(`مبلغ: ${toPersianNumbers(transaction.amount.toLocaleString())} تومان`, 100, yPosition + 15);
                    
                    // Description if exists
                    if (transaction.description) {
                        doc.setFont('helvetica', 'normal');
                        doc.setTextColor(80, 80, 80);
                        const descLines = doc.splitTextToSize(`توضیحات: ${transaction.description}`, 160);
                        doc.text(descLines, 25, yPosition + 25);
                    }
                    
                    yPosition += boxHeight + 8;
                });
            }
            
            // Add Persian footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                
                // Footer line
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.5);
                doc.line(20, 280, 190, 280);
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(120, 120, 120);
                
                // Persian date and time
                const now = new Date();
                const persianDate = now.toLocaleDateString('fa-IR');
                const persianTime = now.toLocaleTimeString('fa-IR');
                doc.text(`تاریخ تولید گزارش: ${toPersianNumbers(persianDate)} - ساعت: ${toPersianNumbers(persianTime)}`, 20, 285);
                
                // Persian page numbers
                doc.text(`صفحه ${toPersianNumbers(i)} از ${toPersianNumbers(pageCount)}`, 170, 285);
                
                // Report title in footer
                doc.text(`گزارش ${person.name}`, 105, 285, { align: 'center' });
            }
            
            // Save with Persian filename
            const persianDate = new Date().toLocaleDateString('fa-IR').replace(/\//g, '-');
            doc.save(`گزارش-${person.name}-${toPersianNumbers(persianDate)}.pdf`);
        }

        // Share Person Report
        function sharePersonReport(platform) {
            if (!currentPersonReport) return;
            
            const person = currentPersonReport;
            const personTransactions = transactions.filter(t => t.personId === person.id);
            const totalCredit = personTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0);
            const totalDebt = personTransactions.filter(t => t.type === 'debt').reduce((sum, t) => sum + t.amount, 0);
            
            const reportText = `📊 گزارش حسابداری - ${person.name}

📱 تلفن: ${person.phone || 'ندارد'}
📍 آدرس: ${person.address || 'ندارد'}

💰 خلاصه مالی:
📈 کل طلب: ${totalCredit.toLocaleString()} تومان
📉 کل بدهی: ${totalDebt.toLocaleString()} تومان
⚖️ موجودی نهایی: ${Math.abs(person.balance).toLocaleString()} تومان (${person.balance >= 0 ? 'طلبکار' : 'بدهکار'})

📋 تعداد تراکنش‌ها: ${personTransactions.length}

تاریخ گزارش: ${new Date().toLocaleDateString('fa-IR')}`;

            const encodedText = encodeURIComponent(reportText);
            
            let shareUrl = '';
            
            switch(platform) {
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodedText}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodedText}`;
                    break;
                case 'eitaa':
                    shareUrl = `https://eitaa.com/share/url?url=${encodedText}`;
                    break;
                case 'sms':
                    shareUrl = `sms:?body=${encodedText}`;
                    break;
                default:
                    // Generic share
                    if (navigator.share) {
                        navigator.share({
                            title: `گزارش حسابداری - ${person.name}`,
                            text: reportText
                        });
                        return;
                    }
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank');
            }
        }

        // Download Individual PDF
        function downloadIndividualPDF(personId) {
            const person = people.find(p => p.id === personId);
            if (!person) return;
            
            const personTransactions = transactions.filter(t => t.personId === personId);
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Persian date conversion
            function toPersianDate(dateStr) {
                return new Date(dateStr).toLocaleDateString('fa-IR');
            }
            
            // Persian number converter
            function toPersianNumbers(str) {
                const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
                const englishDigits = '0123456789';
                return str.toString().replace(/[0-9]/g, function(w) {
                    return persianDigits[englishDigits.indexOf(w)];
                });
            }
            
            // Header with Persian professional formatting
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(22);
            doc.setTextColor(0, 100, 200);
            doc.text(`گزارش تفصیلی - ${person.name}`, 105, 30, { align: 'center' });
            
            let yPosition = 50;
            
            // Add decorative line
            doc.setLineWidth(1);
            doc.setDrawColor(0, 100, 200);
            doc.line(30, yPosition, 180, yPosition);
            yPosition += 25;
            
            // Personal Information Box
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.rect(20, yPosition - 5, 170, 40);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(0, 100, 200);
            doc.text('اطلاعات شخصی', 25, yPosition + 8);
            yPosition += 18;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            if (person.phone) {
                doc.text(`شماره تماس: ${toPersianNumbers(person.phone)}`, 30, yPosition);
                yPosition += 12;
            }
            
            if (person.address) {
                const addressLines = doc.splitTextToSize(`نشانی: ${person.address}`, 160);
                doc.text(addressLines, 30, yPosition);
                yPosition += addressLines.length * 12;
            }
            
            yPosition += 20;
            
            // Financial Summary Box
            doc.setDrawColor(200, 200, 200);
            doc.rect(20, yPosition - 5, 170, 50);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(0, 150, 0);
            doc.text('خلاصه مالی', 25, yPosition + 8);
            yPosition += 18;
            
            const totalCredit = personTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0);
            const totalDebt = personTransactions.filter(t => t.type === 'debt').reduce((sum, t) => sum + t.amount, 0);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(13);
            
            // Credit amount with Persian numbers
            doc.setTextColor(0, 150, 0);
            doc.text(`کل طلب: ${toPersianNumbers(totalCredit.toLocaleString())} تومان`, 30, yPosition);
            yPosition += 12;
            
            // Debt amount with Persian numbers
            doc.setTextColor(200, 0, 0);
            doc.text(`کل بدهی: ${toPersianNumbers(totalDebt.toLocaleString())} تومان`, 30, yPosition);
            yPosition += 12;
            
            // Final balance with Persian numbers and emphasis
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            const balanceColor = person.balance >= 0 ? [0, 150, 0] : [200, 0, 0];
            doc.setTextColor(...balanceColor);
            doc.text(`موجودی نهایی: ${toPersianNumbers(Math.abs(person.balance).toLocaleString())} تومان (${person.balance >= 0 ? 'طلبکار' : 'بدهکار'})`, 30, yPosition);
            
            yPosition += 30;
            
            // Transaction History Section
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 200);
            doc.text(`تاریخچه تراکنش‌ها (${toPersianNumbers(personTransactions.length)} مورد)`, 20, yPosition);
            yPosition += 20;
            
            if (personTransactions.length === 0) {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);
                doc.setTextColor(150, 150, 150);
                doc.text('هیچ تراکنشی ثبت نشده است', 30, yPosition);
            } else {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(11);
                
                personTransactions.forEach((transaction, index) => {
                    // Check for new page
                    if (yPosition > 235) {
                        doc.addPage();
                        yPosition = 30;
                        
                        // Repeat header on new page
                        doc.setFont('helvetica', 'bold');
                        doc.setFontSize(14);
                        doc.setTextColor(0, 0, 200);
                        doc.text(`ادامه تراکنش‌های ${person.name}`, 20, yPosition);
                        yPosition += 20;
                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(11);
                    }
                    
                    // Transaction box
                    const boxHeight = transaction.description ? 40 : 30;
                    doc.setDrawColor(220, 220, 220);
                    doc.setLineWidth(0.3);
                    doc.rect(20, yPosition - 3, 170, boxHeight);
                    
                    // Transaction number and date with Persian numbers
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(0, 0, 0);
                    doc.text(`${toPersianNumbers(index + 1)}. تاریخ: ${toPersianNumbers(toPersianDate(transaction.date))}`, 25, yPosition + 5);
                    
                    // Transaction type with Persian text
                    const typeText = transaction.type === 'credit' ? 'طلبکار' : 'بدهکار';
                    const typeColor = transaction.type === 'credit' ? [0, 150, 0] : [200, 0, 0];
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(...typeColor);
                    doc.text(`نوع: ${typeText}`, 25, yPosition + 15);
                    
                    // Amount with Persian numbers and emphasis
                    doc.setFont('helvetica', 'bold');
                    doc.text(`مبلغ: ${toPersianNumbers(transaction.amount.toLocaleString())} تومان`, 100, yPosition + 15);
                    
                    // Description if exists
                    if (transaction.description) {
                        doc.setFont('helvetica', 'normal');
                        doc.setTextColor(80, 80, 80);
                        const descLines = doc.splitTextToSize(`توضیحات: ${transaction.description}`, 160);
                        doc.text(descLines, 25, yPosition + 25);
                    }
                    
                    yPosition += boxHeight + 10;
                });
            }
            
            // Add Persian professional footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                
                // Footer line
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.5);
                doc.line(20, 280, 190, 280);
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);
                doc.setTextColor(120, 120, 120);
                
                // Persian date and time
                const now = new Date();
                const persianDate = now.toLocaleDateString('fa-IR');
                const persianTime = now.toLocaleTimeString('fa-IR');
                doc.text(`تاریخ تولید گزارش: ${toPersianNumbers(persianDate)} - ساعت: ${toPersianNumbers(persianTime)}`, 20, 285);
                
                // Persian page numbers
                doc.text(`صفحه ${toPersianNumbers(i)} از ${toPersianNumbers(pageCount)}`, 170, 285);
                
                // Report title in footer
                doc.text(`گزارش ${person.name}`, 105, 285, { align: 'center' });
            }
            
            // Save with Persian filename
            const persianDate = new Date().toLocaleDateString('fa-IR').replace(/\//g, '-');
            doc.save(`گزارش-تفصیلی-${person.name}-${toPersianNumbers(persianDate)}.pdf`);
        }

        // Share Individual Report
        function shareIndividualReport(personId, platform) {
            const person = people.find(p => p.id === personId);
            if (!person) return;
            
            const personTransactions = transactions.filter(t => t.personId === personId);
            const totalCredit = personTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0);
            const totalDebt = personTransactions.filter(t => t.type === 'debt').reduce((sum, t) => sum + t.amount, 0);
            
            // Create detailed report text
            let reportText = `📊 گزارش حسابداری - ${person.name}\n\n`;
            
            if (person.phone) reportText += `📱 تلفن: ${person.phone}\n`;
            if (person.address) reportText += `📍 آدرس: ${person.address}\n`;
            
            reportText += `\n💰 خلاصه مالی:\n`;
            reportText += `📈 کل طلب: ${totalCredit.toLocaleString()} تومان\n`;
            reportText += `📉 کل بدهی: ${totalDebt.toLocaleString()} تومان\n`;
            reportText += `⚖️ موجودی نهایی: ${Math.abs(person.balance).toLocaleString()} تومان (${person.balance >= 0 ? 'طلبکار' : 'بدهکار'})\n\n`;
            
            reportText += `📋 تاریخچه تراکنش‌ها (${personTransactions.length} تراکنش):\n`;
            
            if (personTransactions.length === 0) {
                reportText += `هیچ تراکنشی ثبت نشده است\n`;
            } else {
                personTransactions.forEach((transaction, index) => {
                    const typeIcon = transaction.type === 'credit' ? '📈' : '📉';
                    const typeText = transaction.type === 'credit' ? 'طلبکار' : 'بدهکار';
                    
                    reportText += `${index + 1}. ${typeIcon} ${transaction.date} - ${typeText}\n`;
                    reportText += `   مبلغ: ${transaction.amount.toLocaleString()} تومان\n`;
                    if (transaction.description) {
                        reportText += `   توضیحات: ${transaction.description}\n`;
                    }
                    reportText += `\n`;
                });
            }
            
            reportText += `📅 تاریخ گزارش: ${new Date().toLocaleDateString('fa-IR')}`;
            
            const encodedText = encodeURIComponent(reportText);
            
            let shareUrl = '';
            
            switch(platform) {
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodedText}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodedText}`;
                    break;
                case 'eitaa':
                    shareUrl = `https://eitaa.com/share/url?url=${encodedText}`;
                    break;
                case 'sms':
                    shareUrl = `sms:?body=${encodedText}`;
                    break;
                default:
                    // Generic share
                    if (navigator.share) {
                        navigator.share({
                            title: `گزارش حسابداری - ${person.name}`,
                            text: reportText
                        });
                        return;
                    }
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank');
            }
        }

        // Initialize system when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            setupEventListeners();
            initializeSystem();
            loadTheme();
            
            // Check subscription status every hour
            setInterval(() => {
                if (currentUser) {
                    updateTrialStatus();
                    checkSubscriptionStatus();
                }
            }, 3600000); // 1 hour
        });
        
        // Also initialize immediately in case DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            console.log('Document still loading...');
        } else {
            console.log('Document already loaded, initializing...');
            setupEventListeners();
            initializeSystem();
            loadTheme();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e6fc95f231c725',t:'MTc1NTA3NTI1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
